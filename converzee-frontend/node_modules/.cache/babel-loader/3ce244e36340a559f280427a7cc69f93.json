{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.2 (2021-11-17)\n */\n(function () {\n  'use strict';\n\n  var global$6 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var eq = function (t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n  var isNull = eq(null);\n  var isBoolean = isSimpleType('boolean');\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n\n  var noop = function () {};\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var identity = function (x) {\n    return x;\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = identity;\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: function () {\n        return none();\n      },\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var objAcc = function (r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n\n  var internalFilter = function (obj, pred, onTrue, onFalse) {\n    var r = {};\n    each(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n\n  var filter = function (obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var hasNonNullableKey = function (obj, key) {\n    return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n\n  var nativePush = Array.prototype.push;\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var get = function (xs, i) {\n    return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  };\n\n  var head = function (xs) {\n    return get(xs, 0);\n  };\n\n  var findMap = function (arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n\n      if (r.isSome()) {\n        return r;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  typeof window !== 'undefined' ? window : Function('return this;')();\n\n  var rawSet = function (dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n\n  var set = function (element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n\n  var remove = function (element, key) {\n    element.dom.removeAttribute(key);\n  };\n\n  var fromHtml = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n\n    return fromDom(div.childNodes[0]);\n  };\n\n  var fromTag = function (tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n\n  var fromText = function (text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n\n  var fromDom = function (node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n\n    return {\n      dom: node\n    };\n  };\n\n  var fromPoint = function (docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n  var global$5 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$4 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n  var global$3 = tinymce.util.Tools.resolve('tinymce.util.URI');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n  var hasDimensions = function (editor) {\n    return editor.getParam('image_dimensions', true, 'boolean');\n  };\n\n  var hasAdvTab = function (editor) {\n    return editor.getParam('image_advtab', false, 'boolean');\n  };\n\n  var hasUploadTab = function (editor) {\n    return editor.getParam('image_uploadtab', true, 'boolean');\n  };\n\n  var getPrependUrl = function (editor) {\n    return editor.getParam('image_prepend_url', '', 'string');\n  };\n\n  var getClassList = function (editor) {\n    return editor.getParam('image_class_list');\n  };\n\n  var hasDescription = function (editor) {\n    return editor.getParam('image_description', true, 'boolean');\n  };\n\n  var hasImageTitle = function (editor) {\n    return editor.getParam('image_title', false, 'boolean');\n  };\n\n  var hasImageCaption = function (editor) {\n    return editor.getParam('image_caption', false, 'boolean');\n  };\n\n  var getImageList = function (editor) {\n    return editor.getParam('image_list', false);\n  };\n\n  var hasUploadUrl = function (editor) {\n    return isNonNullable(editor.getParam('images_upload_url'));\n  };\n\n  var hasUploadHandler = function (editor) {\n    return isNonNullable(editor.getParam('images_upload_handler'));\n  };\n\n  var showAccessibilityOptions = function (editor) {\n    return editor.getParam('a11y_advanced_options', false, 'boolean');\n  };\n\n  var isAutomaticUploadsEnabled = function (editor) {\n    return editor.getParam('automatic_uploads', true, 'boolean');\n  };\n\n  var parseIntAndGetMax = function (val1, val2) {\n    return Math.max(parseInt(val1, 10), parseInt(val2, 10));\n  };\n\n  var getImageSize = function (url) {\n    return new global$4(function (callback) {\n      var img = document.createElement('img');\n\n      var done = function (dimensions) {\n        img.onload = img.onerror = null;\n\n        if (img.parentNode) {\n          img.parentNode.removeChild(img);\n        }\n\n        callback(dimensions);\n      };\n\n      img.onload = function () {\n        var width = parseIntAndGetMax(img.width, img.clientWidth);\n        var height = parseIntAndGetMax(img.height, img.clientHeight);\n        var dimensions = {\n          width: width,\n          height: height\n        };\n        done(global$4.resolve(dimensions));\n      };\n\n      img.onerror = function () {\n        done(global$4.reject('Failed to get image dimensions for: ' + url));\n      };\n\n      var style = img.style;\n      style.visibility = 'hidden';\n      style.position = 'fixed';\n      style.bottom = style.left = '0px';\n      style.width = style.height = 'auto';\n      document.body.appendChild(img);\n      img.src = url;\n    });\n  };\n\n  var removePixelSuffix = function (value) {\n    if (value) {\n      value = value.replace(/px$/, '');\n    }\n\n    return value;\n  };\n\n  var addPixelSuffix = function (value) {\n    if (value.length > 0 && /^[0-9]+$/.test(value)) {\n      value += 'px';\n    }\n\n    return value;\n  };\n\n  var mergeMargins = function (css) {\n    if (css.margin) {\n      var splitMargin = String(css.margin).split(' ');\n\n      switch (splitMargin.length) {\n        case 1:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[0];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[0];\n          break;\n\n        case 2:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n\n        case 3:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n\n        case 4:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[3];\n      }\n\n      delete css.margin;\n    }\n\n    return css;\n  };\n\n  var createImageList = function (editor, callback) {\n    var imageList = getImageList(editor);\n\n    if (isString(imageList)) {\n      global$2.send({\n        url: imageList,\n        success: function (text) {\n          callback(JSON.parse(text));\n        }\n      });\n    } else if (isFunction(imageList)) {\n      imageList(callback);\n    } else {\n      callback(imageList);\n    }\n  };\n\n  var waitLoadImage = function (editor, data, imgElm) {\n    var selectImage = function () {\n      imgElm.onload = imgElm.onerror = null;\n\n      if (editor.selection) {\n        editor.selection.select(imgElm);\n        editor.nodeChanged();\n      }\n    };\n\n    imgElm.onload = function () {\n      if (!data.width && !data.height && hasDimensions(editor)) {\n        editor.dom.setAttribs(imgElm, {\n          width: String(imgElm.clientWidth),\n          height: String(imgElm.clientHeight)\n        });\n      }\n\n      selectImage();\n    };\n\n    imgElm.onerror = selectImage;\n  };\n\n  var blobToDataUri = function (blob) {\n    return new global$4(function (resolve, reject) {\n      var reader = new FileReader();\n\n      reader.onload = function () {\n        resolve(reader.result);\n      };\n\n      reader.onerror = function () {\n        reject(reader.error.message);\n      };\n\n      reader.readAsDataURL(blob);\n    });\n  };\n\n  var isPlaceholderImage = function (imgElm) {\n    return imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));\n  };\n\n  var isSafeImageUrl = function (editor, src) {\n    return global$3.isDomSafe(src, 'img', editor.settings);\n  };\n\n  var DOM = global$5.DOM;\n\n  var getHspace = function (image) {\n    if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {\n      return removePixelSuffix(image.style.marginLeft);\n    } else {\n      return '';\n    }\n  };\n\n  var getVspace = function (image) {\n    if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {\n      return removePixelSuffix(image.style.marginTop);\n    } else {\n      return '';\n    }\n  };\n\n  var getBorder = function (image) {\n    if (image.style.borderWidth) {\n      return removePixelSuffix(image.style.borderWidth);\n    } else {\n      return '';\n    }\n  };\n\n  var getAttrib = function (image, name) {\n    if (image.hasAttribute(name)) {\n      return image.getAttribute(name);\n    } else {\n      return '';\n    }\n  };\n\n  var getStyle = function (image, name) {\n    return image.style[name] ? image.style[name] : '';\n  };\n\n  var hasCaption = function (image) {\n    return image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';\n  };\n\n  var updateAttrib = function (image, name, value) {\n    if (value === '') {\n      image.removeAttribute(name);\n    } else {\n      image.setAttribute(name, value);\n    }\n  };\n\n  var wrapInFigure = function (image) {\n    var figureElm = DOM.create('figure', {\n      class: 'image'\n    });\n    DOM.insertAfter(figureElm, image);\n    figureElm.appendChild(image);\n    figureElm.appendChild(DOM.create('figcaption', {\n      contentEditable: 'true'\n    }, 'Caption'));\n    figureElm.contentEditable = 'false';\n  };\n\n  var removeFigure = function (image) {\n    var figureElm = image.parentNode;\n    DOM.insertAfter(image, figureElm);\n    DOM.remove(figureElm);\n  };\n\n  var toggleCaption = function (image) {\n    if (hasCaption(image)) {\n      removeFigure(image);\n    } else {\n      wrapInFigure(image);\n    }\n  };\n\n  var normalizeStyle = function (image, normalizeCss) {\n    var attrValue = image.getAttribute('style');\n    var value = normalizeCss(attrValue !== null ? attrValue : '');\n\n    if (value.length > 0) {\n      image.setAttribute('style', value);\n      image.setAttribute('data-mce-style', value);\n    } else {\n      image.removeAttribute('style');\n    }\n  };\n\n  var setSize = function (name, normalizeCss) {\n    return function (image, name, value) {\n      if (image.style[name]) {\n        image.style[name] = addPixelSuffix(value);\n        normalizeStyle(image, normalizeCss);\n      } else {\n        updateAttrib(image, name, value);\n      }\n    };\n  };\n\n  var getSize = function (image, name) {\n    if (image.style[name]) {\n      return removePixelSuffix(image.style[name]);\n    } else {\n      return getAttrib(image, name);\n    }\n  };\n\n  var setHspace = function (image, value) {\n    var pxValue = addPixelSuffix(value);\n    image.style.marginLeft = pxValue;\n    image.style.marginRight = pxValue;\n  };\n\n  var setVspace = function (image, value) {\n    var pxValue = addPixelSuffix(value);\n    image.style.marginTop = pxValue;\n    image.style.marginBottom = pxValue;\n  };\n\n  var setBorder = function (image, value) {\n    var pxValue = addPixelSuffix(value);\n    image.style.borderWidth = pxValue;\n  };\n\n  var setBorderStyle = function (image, value) {\n    image.style.borderStyle = value;\n  };\n\n  var getBorderStyle = function (image) {\n    return getStyle(image, 'borderStyle');\n  };\n\n  var isFigure = function (elm) {\n    return elm.nodeName === 'FIGURE';\n  };\n\n  var isImage = function (elm) {\n    return elm.nodeName === 'IMG';\n  };\n\n  var getIsDecorative = function (image) {\n    return DOM.getAttrib(image, 'alt').length === 0 && DOM.getAttrib(image, 'role') === 'presentation';\n  };\n\n  var getAlt = function (image) {\n    if (getIsDecorative(image)) {\n      return '';\n    } else {\n      return getAttrib(image, 'alt');\n    }\n  };\n\n  var defaultData = function () {\n    return {\n      src: '',\n      alt: '',\n      title: '',\n      width: '',\n      height: '',\n      class: '',\n      style: '',\n      caption: false,\n      hspace: '',\n      vspace: '',\n      border: '',\n      borderStyle: '',\n      isDecorative: false\n    };\n  };\n\n  var getStyleValue = function (normalizeCss, data) {\n    var image = document.createElement('img');\n    updateAttrib(image, 'style', data.style);\n\n    if (getHspace(image) || data.hspace !== '') {\n      setHspace(image, data.hspace);\n    }\n\n    if (getVspace(image) || data.vspace !== '') {\n      setVspace(image, data.vspace);\n    }\n\n    if (getBorder(image) || data.border !== '') {\n      setBorder(image, data.border);\n    }\n\n    if (getBorderStyle(image) || data.borderStyle !== '') {\n      setBorderStyle(image, data.borderStyle);\n    }\n\n    return normalizeCss(image.getAttribute('style'));\n  };\n\n  var create = function (normalizeCss, data) {\n    var image = document.createElement('img');\n    write(normalizeCss, __assign(__assign({}, data), {\n      caption: false\n    }), image);\n    setAlt(image, data.alt, data.isDecorative);\n\n    if (data.caption) {\n      var figure = DOM.create('figure', {\n        class: 'image'\n      });\n      figure.appendChild(image);\n      figure.appendChild(DOM.create('figcaption', {\n        contentEditable: 'true'\n      }, 'Caption'));\n      figure.contentEditable = 'false';\n      return figure;\n    } else {\n      return image;\n    }\n  };\n\n  var read = function (normalizeCss, image) {\n    return {\n      src: getAttrib(image, 'src'),\n      alt: getAlt(image),\n      title: getAttrib(image, 'title'),\n      width: getSize(image, 'width'),\n      height: getSize(image, 'height'),\n      class: getAttrib(image, 'class'),\n      style: normalizeCss(getAttrib(image, 'style')),\n      caption: hasCaption(image),\n      hspace: getHspace(image),\n      vspace: getVspace(image),\n      border: getBorder(image),\n      borderStyle: getStyle(image, 'borderStyle'),\n      isDecorative: getIsDecorative(image)\n    };\n  };\n\n  var updateProp = function (image, oldData, newData, name, set) {\n    if (newData[name] !== oldData[name]) {\n      set(image, name, newData[name]);\n    }\n  };\n\n  var setAlt = function (image, alt, isDecorative) {\n    if (isDecorative) {\n      DOM.setAttrib(image, 'role', 'presentation');\n      var sugarImage = SugarElement.fromDom(image);\n      set(sugarImage, 'alt', '');\n    } else {\n      if (isNull(alt)) {\n        var sugarImage = SugarElement.fromDom(image);\n        remove(sugarImage, 'alt');\n      } else {\n        var sugarImage = SugarElement.fromDom(image);\n        set(sugarImage, 'alt', alt);\n      }\n\n      if (DOM.getAttrib(image, 'role') === 'presentation') {\n        DOM.setAttrib(image, 'role', '');\n      }\n    }\n  };\n\n  var updateAlt = function (image, oldData, newData) {\n    if (newData.alt !== oldData.alt || newData.isDecorative !== oldData.isDecorative) {\n      setAlt(image, newData.alt, newData.isDecorative);\n    }\n  };\n\n  var normalized = function (set, normalizeCss) {\n    return function (image, name, value) {\n      set(image, value);\n      normalizeStyle(image, normalizeCss);\n    };\n  };\n\n  var write = function (normalizeCss, newData, image) {\n    var oldData = read(normalizeCss, image);\n    updateProp(image, oldData, newData, 'caption', function (image, _name, _value) {\n      return toggleCaption(image);\n    });\n    updateProp(image, oldData, newData, 'src', updateAttrib);\n    updateProp(image, oldData, newData, 'title', updateAttrib);\n    updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));\n    updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));\n    updateProp(image, oldData, newData, 'class', updateAttrib);\n    updateProp(image, oldData, newData, 'style', normalized(function (image, value) {\n      return updateAttrib(image, 'style', value);\n    }, normalizeCss));\n    updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));\n    updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));\n    updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));\n    updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));\n    updateAlt(image, oldData, newData);\n  };\n\n  var normalizeCss$1 = function (editor, cssText) {\n    var css = editor.dom.styles.parse(cssText);\n    var mergedCss = mergeMargins(css);\n    var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));\n    return editor.dom.styles.serialize(compressed);\n  };\n\n  var getSelectedImage = function (editor) {\n    var imgElm = editor.selection.getNode();\n    var figureElm = editor.dom.getParent(imgElm, 'figure.image');\n\n    if (figureElm) {\n      return editor.dom.select('img', figureElm)[0];\n    }\n\n    if (imgElm && (imgElm.nodeName !== 'IMG' || isPlaceholderImage(imgElm))) {\n      return null;\n    }\n\n    return imgElm;\n  };\n\n  var splitTextBlock = function (editor, figure) {\n    var dom = editor.dom;\n    var textBlockElements = filter(editor.schema.getTextBlockElements(), function (_, parentElm) {\n      return !editor.schema.isValidChild(parentElm, 'figure');\n    });\n    var textBlock = dom.getParent(figure.parentNode, function (node) {\n      return hasNonNullableKey(textBlockElements, node.nodeName);\n    }, editor.getBody());\n\n    if (textBlock) {\n      return dom.split(textBlock, figure);\n    } else {\n      return figure;\n    }\n  };\n\n  var readImageDataFromSelection = function (editor) {\n    var image = getSelectedImage(editor);\n    return image ? read(function (css) {\n      return normalizeCss$1(editor, css);\n    }, image) : defaultData();\n  };\n\n  var insertImageAtCaret = function (editor, data) {\n    var elm = create(function (css) {\n      return normalizeCss$1(editor, css);\n    }, data);\n    editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');\n    editor.focus();\n    editor.selection.setContent(elm.outerHTML);\n    var insertedElm = editor.dom.select('*[data-mce-id=\"__mcenew\"]')[0];\n    editor.dom.setAttrib(insertedElm, 'data-mce-id', null);\n\n    if (isFigure(insertedElm)) {\n      var figure = splitTextBlock(editor, insertedElm);\n      editor.selection.select(figure);\n    } else {\n      editor.selection.select(insertedElm);\n    }\n  };\n\n  var syncSrcAttr = function (editor, image) {\n    editor.dom.setAttrib(image, 'src', image.getAttribute('src'));\n  };\n\n  var deleteImage = function (editor, image) {\n    if (image) {\n      var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;\n      editor.dom.remove(elm);\n      editor.focus();\n      editor.nodeChanged();\n\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      }\n    }\n  };\n\n  var writeImageDataToSelection = function (editor, data) {\n    var image = getSelectedImage(editor);\n    write(function (css) {\n      return normalizeCss$1(editor, css);\n    }, data, image);\n    syncSrcAttr(editor, image);\n\n    if (isFigure(image.parentNode)) {\n      var figure = image.parentNode;\n      splitTextBlock(editor, figure);\n      editor.selection.select(image.parentNode);\n    } else {\n      editor.selection.select(image);\n      waitLoadImage(editor, data, image);\n    }\n  };\n\n  var sanitizeImageData = function (editor, data) {\n    var src = data.src;\n    return __assign(__assign({}, data), {\n      src: isSafeImageUrl(editor, src) ? src : ''\n    });\n  };\n\n  var insertOrUpdateImage = function (editor, partialData) {\n    var image = getSelectedImage(editor);\n\n    if (image) {\n      var selectedImageData = read(function (css) {\n        return normalizeCss$1(editor, css);\n      }, image);\n\n      var data = __assign(__assign({}, selectedImageData), partialData);\n\n      var sanitizedData = sanitizeImageData(editor, data);\n\n      if (data.src) {\n        writeImageDataToSelection(editor, sanitizedData);\n      } else {\n        deleteImage(editor, image);\n      }\n    } else if (partialData.src) {\n      insertImageAtCaret(editor, __assign(__assign({}, defaultData()), partialData));\n    }\n  };\n\n  var deep = function (old, nu) {\n    var bothObjects = isObject(old) && isObject(nu);\n    return bothObjects ? deepMerge(old, nu) : nu;\n  };\n\n  var baseMerge = function (merger) {\n    return function () {\n      var objects = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        objects[_i] = arguments[_i];\n      }\n\n      if (objects.length === 0) {\n        throw new Error('Can\\'t merge zero objects');\n      }\n\n      var ret = {};\n\n      for (var j = 0; j < objects.length; j++) {\n        var curObject = objects[j];\n\n        for (var key in curObject) {\n          if (has(curObject, key)) {\n            ret[key] = merger(ret[key], curObject[key]);\n          }\n        }\n      }\n\n      return ret;\n    };\n  };\n\n  var deepMerge = baseMerge(deep);\n\n  var isNotEmpty = function (s) {\n    return s.length > 0;\n  };\n\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.ImageUploader');\n  var global = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n  var getValue = function (item) {\n    return isString(item.value) ? item.value : '';\n  };\n\n  var getText = function (item) {\n    if (isString(item.text)) {\n      return item.text;\n    } else if (isString(item.title)) {\n      return item.title;\n    } else {\n      return '';\n    }\n  };\n\n  var sanitizeList = function (list, extractValue) {\n    var out = [];\n    global.each(list, function (item) {\n      var text = getText(item);\n\n      if (item.menu !== undefined) {\n        var items = sanitizeList(item.menu, extractValue);\n        out.push({\n          text: text,\n          items: items\n        });\n      } else {\n        var value = extractValue(item);\n        out.push({\n          text: text,\n          value: value\n        });\n      }\n    });\n    return out;\n  };\n\n  var sanitizer = function (extractor) {\n    if (extractor === void 0) {\n      extractor = getValue;\n    }\n\n    return function (list) {\n      if (list) {\n        return Optional.from(list).map(function (list) {\n          return sanitizeList(list, extractor);\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n  };\n\n  var sanitize = function (list) {\n    return sanitizer(getValue)(list);\n  };\n\n  var isGroup = function (item) {\n    return has(item, 'items');\n  };\n\n  var findEntryDelegate = function (list, value) {\n    return findMap(list, function (item) {\n      if (isGroup(item)) {\n        return findEntryDelegate(item.items, value);\n      } else if (item.value === value) {\n        return Optional.some(item);\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var findEntry = function (optList, value) {\n    return optList.bind(function (list) {\n      return findEntryDelegate(list, value);\n    });\n  };\n\n  var ListUtils = {\n    sanitizer: sanitizer,\n    sanitize: sanitize,\n    findEntry: findEntry\n  };\n\n  var makeTab$2 = function (_info) {\n    return {\n      title: 'Advanced',\n      name: 'advanced',\n      items: [{\n        type: 'input',\n        label: 'Style',\n        name: 'style'\n      }, {\n        type: 'grid',\n        columns: 2,\n        items: [{\n          type: 'input',\n          label: 'Vertical space',\n          name: 'vspace',\n          inputMode: 'numeric'\n        }, {\n          type: 'input',\n          label: 'Horizontal space',\n          name: 'hspace',\n          inputMode: 'numeric'\n        }, {\n          type: 'input',\n          label: 'Border width',\n          name: 'border',\n          inputMode: 'numeric'\n        }, {\n          type: 'listbox',\n          name: 'borderstyle',\n          label: 'Border style',\n          items: [{\n            text: 'Select...',\n            value: ''\n          }, {\n            text: 'Solid',\n            value: 'solid'\n          }, {\n            text: 'Dotted',\n            value: 'dotted'\n          }, {\n            text: 'Dashed',\n            value: 'dashed'\n          }, {\n            text: 'Double',\n            value: 'double'\n          }, {\n            text: 'Groove',\n            value: 'groove'\n          }, {\n            text: 'Ridge',\n            value: 'ridge'\n          }, {\n            text: 'Inset',\n            value: 'inset'\n          }, {\n            text: 'Outset',\n            value: 'outset'\n          }, {\n            text: 'None',\n            value: 'none'\n          }, {\n            text: 'Hidden',\n            value: 'hidden'\n          }]\n        }]\n      }]\n    };\n  };\n\n  var AdvTab = {\n    makeTab: makeTab$2\n  };\n\n  var collect = function (editor) {\n    var urlListSanitizer = ListUtils.sanitizer(function (item) {\n      return editor.convertURL(item.value || item.url, 'src');\n    });\n    var futureImageList = new global$4(function (completer) {\n      createImageList(editor, function (imageList) {\n        completer(urlListSanitizer(imageList).map(function (items) {\n          return flatten([[{\n            text: 'None',\n            value: ''\n          }], items]);\n        }));\n      });\n    });\n    var classList = ListUtils.sanitize(getClassList(editor));\n    var hasAdvTab$1 = hasAdvTab(editor);\n    var hasUploadTab$1 = hasUploadTab(editor);\n    var hasUploadUrl$1 = hasUploadUrl(editor);\n    var hasUploadHandler$1 = hasUploadHandler(editor);\n    var image = readImageDataFromSelection(editor);\n    var hasDescription$1 = hasDescription(editor);\n    var hasImageTitle$1 = hasImageTitle(editor);\n    var hasDimensions$1 = hasDimensions(editor);\n    var hasImageCaption$1 = hasImageCaption(editor);\n    var hasAccessibilityOptions = showAccessibilityOptions(editor);\n    var automaticUploads = isAutomaticUploadsEnabled(editor);\n    var prependURL = Optional.some(getPrependUrl(editor)).filter(function (preUrl) {\n      return isString(preUrl) && preUrl.length > 0;\n    });\n    return futureImageList.then(function (imageList) {\n      return {\n        image: image,\n        imageList: imageList,\n        classList: classList,\n        hasAdvTab: hasAdvTab$1,\n        hasUploadTab: hasUploadTab$1,\n        hasUploadUrl: hasUploadUrl$1,\n        hasUploadHandler: hasUploadHandler$1,\n        hasDescription: hasDescription$1,\n        hasImageTitle: hasImageTitle$1,\n        hasDimensions: hasDimensions$1,\n        hasImageCaption: hasImageCaption$1,\n        prependURL: prependURL,\n        hasAccessibilityOptions: hasAccessibilityOptions,\n        automaticUploads: automaticUploads\n      };\n    });\n  };\n\n  var makeItems = function (info) {\n    var imageUrl = {\n      name: 'src',\n      type: 'urlinput',\n      filetype: 'image',\n      label: 'Source'\n    };\n    var imageList = info.imageList.map(function (items) {\n      return {\n        name: 'images',\n        type: 'listbox',\n        label: 'Image list',\n        items: items\n      };\n    });\n    var imageDescription = {\n      name: 'alt',\n      type: 'input',\n      label: 'Alternative description',\n      disabled: info.hasAccessibilityOptions && info.image.isDecorative\n    };\n    var imageTitle = {\n      name: 'title',\n      type: 'input',\n      label: 'Image title'\n    };\n    var imageDimensions = {\n      name: 'dimensions',\n      type: 'sizeinput'\n    };\n    var isDecorative = {\n      type: 'label',\n      label: 'Accessibility',\n      items: [{\n        name: 'isDecorative',\n        type: 'checkbox',\n        label: 'Image is decorative'\n      }]\n    };\n    var classList = info.classList.map(function (items) {\n      return {\n        name: 'classes',\n        type: 'listbox',\n        label: 'Class',\n        items: items\n      };\n    });\n    var caption = {\n      type: 'label',\n      label: 'Caption',\n      items: [{\n        type: 'checkbox',\n        name: 'caption',\n        label: 'Show caption'\n      }]\n    };\n\n    var getDialogContainerType = function (useColumns) {\n      return useColumns ? {\n        type: 'grid',\n        columns: 2\n      } : {\n        type: 'panel'\n      };\n    };\n\n    return flatten([[imageUrl], imageList.toArray(), info.hasAccessibilityOptions && info.hasDescription ? [isDecorative] : [], info.hasDescription ? [imageDescription] : [], info.hasImageTitle ? [imageTitle] : [], info.hasDimensions ? [imageDimensions] : [], [__assign(__assign({}, getDialogContainerType(info.classList.isSome() && info.hasImageCaption)), {\n      items: flatten([classList.toArray(), info.hasImageCaption ? [caption] : []])\n    })]]);\n  };\n\n  var makeTab$1 = function (info) {\n    return {\n      title: 'General',\n      name: 'general',\n      items: makeItems(info)\n    };\n  };\n\n  var MainTab = {\n    makeTab: makeTab$1,\n    makeItems: makeItems\n  };\n\n  var makeTab = function (_info) {\n    var items = [{\n      type: 'dropzone',\n      name: 'fileinput'\n    }];\n    return {\n      title: 'Upload',\n      name: 'upload',\n      items: items\n    };\n  };\n\n  var UploadTab = {\n    makeTab: makeTab\n  };\n\n  var createState = function (info) {\n    return {\n      prevImage: ListUtils.findEntry(info.imageList, info.image.src),\n      prevAlt: info.image.alt,\n      open: true\n    };\n  };\n\n  var fromImageData = function (image) {\n    return {\n      src: {\n        value: image.src,\n        meta: {}\n      },\n      images: image.src,\n      alt: image.alt,\n      title: image.title,\n      dimensions: {\n        width: image.width,\n        height: image.height\n      },\n      classes: image.class,\n      caption: image.caption,\n      style: image.style,\n      vspace: image.vspace,\n      border: image.border,\n      hspace: image.hspace,\n      borderstyle: image.borderStyle,\n      fileinput: [],\n      isDecorative: image.isDecorative\n    };\n  };\n\n  var toImageData = function (data, removeEmptyAlt) {\n    return {\n      src: data.src.value,\n      alt: data.alt.length === 0 && removeEmptyAlt ? null : data.alt,\n      title: data.title,\n      width: data.dimensions.width,\n      height: data.dimensions.height,\n      class: data.classes,\n      style: data.style,\n      caption: data.caption,\n      hspace: data.hspace,\n      vspace: data.vspace,\n      border: data.border,\n      borderStyle: data.borderstyle,\n      isDecorative: data.isDecorative\n    };\n  };\n\n  var addPrependUrl2 = function (info, srcURL) {\n    if (!/^(?:[a-zA-Z]+:)?\\/\\//.test(srcURL)) {\n      return info.prependURL.bind(function (prependUrl) {\n        if (srcURL.substring(0, prependUrl.length) !== prependUrl) {\n          return Optional.some(prependUrl + srcURL);\n        }\n\n        return Optional.none();\n      });\n    }\n\n    return Optional.none();\n  };\n\n  var addPrependUrl = function (info, api) {\n    var data = api.getData();\n    addPrependUrl2(info, data.src.value).each(function (srcURL) {\n      api.setData({\n        src: {\n          value: srcURL,\n          meta: data.src.meta\n        }\n      });\n    });\n  };\n\n  var formFillFromMeta2 = function (info, data, meta) {\n    if (info.hasDescription && isString(meta.alt)) {\n      data.alt = meta.alt;\n    }\n\n    if (info.hasAccessibilityOptions) {\n      data.isDecorative = meta.isDecorative || data.isDecorative || false;\n    }\n\n    if (info.hasImageTitle && isString(meta.title)) {\n      data.title = meta.title;\n    }\n\n    if (info.hasDimensions) {\n      if (isString(meta.width)) {\n        data.dimensions.width = meta.width;\n      }\n\n      if (isString(meta.height)) {\n        data.dimensions.height = meta.height;\n      }\n    }\n\n    if (isString(meta.class)) {\n      ListUtils.findEntry(info.classList, meta.class).each(function (entry) {\n        data.classes = entry.value;\n      });\n    }\n\n    if (info.hasImageCaption) {\n      if (isBoolean(meta.caption)) {\n        data.caption = meta.caption;\n      }\n    }\n\n    if (info.hasAdvTab) {\n      if (isString(meta.style)) {\n        data.style = meta.style;\n      }\n\n      if (isString(meta.vspace)) {\n        data.vspace = meta.vspace;\n      }\n\n      if (isString(meta.border)) {\n        data.border = meta.border;\n      }\n\n      if (isString(meta.hspace)) {\n        data.hspace = meta.hspace;\n      }\n\n      if (isString(meta.borderstyle)) {\n        data.borderstyle = meta.borderstyle;\n      }\n    }\n  };\n\n  var formFillFromMeta = function (info, api) {\n    var data = api.getData();\n    var meta = data.src.meta;\n\n    if (meta !== undefined) {\n      var newData = deepMerge({}, data);\n      formFillFromMeta2(info, newData, meta);\n      api.setData(newData);\n    }\n  };\n\n  var calculateImageSize = function (helpers, info, state, api) {\n    var data = api.getData();\n    var url = data.src.value;\n    var meta = data.src.meta || {};\n\n    if (!meta.width && !meta.height && info.hasDimensions) {\n      if (isNotEmpty(url)) {\n        helpers.imageSize(url).then(function (size) {\n          if (state.open) {\n            api.setData({\n              dimensions: size\n            });\n          }\n        }).catch(function (e) {\n          return console.error(e);\n        });\n      } else {\n        api.setData({\n          dimensions: {\n            width: '',\n            height: ''\n          }\n        });\n      }\n    }\n  };\n\n  var updateImagesDropdown = function (info, state, api) {\n    var data = api.getData();\n    var image = ListUtils.findEntry(info.imageList, data.src.value);\n    state.prevImage = image;\n    api.setData({\n      images: image.map(function (entry) {\n        return entry.value;\n      }).getOr('')\n    });\n  };\n\n  var changeSrc = function (helpers, info, state, api) {\n    addPrependUrl(info, api);\n    formFillFromMeta(info, api);\n    calculateImageSize(helpers, info, state, api);\n    updateImagesDropdown(info, state, api);\n  };\n\n  var changeImages = function (helpers, info, state, api) {\n    var data = api.getData();\n    var image = ListUtils.findEntry(info.imageList, data.images);\n    image.each(function (img) {\n      var updateAlt = data.alt === '' || state.prevImage.map(function (image) {\n        return image.text === data.alt;\n      }).getOr(false);\n\n      if (updateAlt) {\n        if (img.value === '') {\n          api.setData({\n            src: img,\n            alt: state.prevAlt\n          });\n        } else {\n          api.setData({\n            src: img,\n            alt: img.text\n          });\n        }\n      } else {\n        api.setData({\n          src: img\n        });\n      }\n    });\n    state.prevImage = image;\n    changeSrc(helpers, info, state, api);\n  };\n\n  var calcVSpace = function (css) {\n    var matchingTopBottom = css['margin-top'] && css['margin-bottom'] && css['margin-top'] === css['margin-bottom'];\n    return matchingTopBottom ? removePixelSuffix(String(css['margin-top'])) : '';\n  };\n\n  var calcHSpace = function (css) {\n    var matchingLeftRight = css['margin-right'] && css['margin-left'] && css['margin-right'] === css['margin-left'];\n    return matchingLeftRight ? removePixelSuffix(String(css['margin-right'])) : '';\n  };\n\n  var calcBorderWidth = function (css) {\n    return css['border-width'] ? removePixelSuffix(String(css['border-width'])) : '';\n  };\n\n  var calcBorderStyle = function (css) {\n    return css['border-style'] ? String(css['border-style']) : '';\n  };\n\n  var calcStyle = function (parseStyle, serializeStyle, css) {\n    return serializeStyle(parseStyle(serializeStyle(css)));\n  };\n\n  var changeStyle2 = function (parseStyle, serializeStyle, data) {\n    var css = mergeMargins(parseStyle(data.style));\n    var dataCopy = deepMerge({}, data);\n    dataCopy.vspace = calcVSpace(css);\n    dataCopy.hspace = calcHSpace(css);\n    dataCopy.border = calcBorderWidth(css);\n    dataCopy.borderstyle = calcBorderStyle(css);\n    dataCopy.style = calcStyle(parseStyle, serializeStyle, css);\n    return dataCopy;\n  };\n\n  var changeStyle = function (helpers, api) {\n    var data = api.getData();\n    var newData = changeStyle2(helpers.parseStyle, helpers.serializeStyle, data);\n    api.setData(newData);\n  };\n\n  var changeAStyle = function (helpers, info, api) {\n    var data = deepMerge(fromImageData(info.image), api.getData());\n    var style = getStyleValue(helpers.normalizeCss, toImageData(data, false));\n    api.setData({\n      style: style\n    });\n  };\n\n  var changeFileInput = function (helpers, info, state, api) {\n    var data = api.getData();\n    api.block('Uploading image');\n    head(data.fileinput).fold(function () {\n      api.unblock();\n    }, function (file) {\n      var blobUri = URL.createObjectURL(file);\n\n      var finalize = function () {\n        api.unblock();\n        URL.revokeObjectURL(blobUri);\n      };\n\n      var updateSrcAndSwitchTab = function (url) {\n        api.setData({\n          src: {\n            value: url,\n            meta: {}\n          }\n        });\n        api.showTab('general');\n        changeSrc(helpers, info, state, api);\n      };\n\n      blobToDataUri(file).then(function (dataUrl) {\n        var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);\n\n        if (info.automaticUploads) {\n          helpers.uploadImage(blobInfo).then(function (result) {\n            updateSrcAndSwitchTab(result.url);\n            finalize();\n          }).catch(function (err) {\n            finalize();\n            helpers.alertErr(err);\n          });\n        } else {\n          helpers.addToBlobCache(blobInfo);\n          updateSrcAndSwitchTab(blobInfo.blobUri());\n          api.unblock();\n        }\n      });\n    });\n  };\n\n  var changeHandler = function (helpers, info, state) {\n    return function (api, evt) {\n      if (evt.name === 'src') {\n        changeSrc(helpers, info, state, api);\n      } else if (evt.name === 'images') {\n        changeImages(helpers, info, state, api);\n      } else if (evt.name === 'alt') {\n        state.prevAlt = api.getData().alt;\n      } else if (evt.name === 'style') {\n        changeStyle(helpers, api);\n      } else if (evt.name === 'vspace' || evt.name === 'hspace' || evt.name === 'border' || evt.name === 'borderstyle') {\n        changeAStyle(helpers, info, api);\n      } else if (evt.name === 'fileinput') {\n        changeFileInput(helpers, info, state, api);\n      } else if (evt.name === 'isDecorative') {\n        if (api.getData().isDecorative) {\n          api.disable('alt');\n        } else {\n          api.enable('alt');\n        }\n      }\n    };\n  };\n\n  var closeHandler = function (state) {\n    return function () {\n      state.open = false;\n    };\n  };\n\n  var makeDialogBody = function (info) {\n    if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {\n      var tabPanel = {\n        type: 'tabpanel',\n        tabs: flatten([[MainTab.makeTab(info)], info.hasAdvTab ? [AdvTab.makeTab(info)] : [], info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []])\n      };\n      return tabPanel;\n    } else {\n      var panel = {\n        type: 'panel',\n        items: MainTab.makeItems(info)\n      };\n      return panel;\n    }\n  };\n\n  var makeDialog = function (helpers) {\n    return function (info) {\n      var state = createState(info);\n      return {\n        title: 'Insert/Edit Image',\n        size: 'normal',\n        body: makeDialogBody(info),\n        buttons: [{\n          type: 'cancel',\n          name: 'cancel',\n          text: 'Cancel'\n        }, {\n          type: 'submit',\n          name: 'save',\n          text: 'Save',\n          primary: true\n        }],\n        initialData: fromImageData(info.image),\n        onSubmit: helpers.onSubmit(info),\n        onChange: changeHandler(helpers, info, state),\n        onClose: closeHandler(state)\n      };\n    };\n  };\n\n  var submitHandler = function (editor) {\n    return function (info) {\n      return function (api) {\n        var data = deepMerge(fromImageData(info.image), api.getData());\n        editor.execCommand('mceUpdateImage', false, toImageData(data, info.hasAccessibilityOptions));\n        editor.editorUpload.uploadImagesAuto();\n        api.close();\n      };\n    };\n  };\n\n  var imageSize = function (editor) {\n    return function (url) {\n      if (!isSafeImageUrl(editor, url)) {\n        return global$4.resolve({\n          width: '',\n          height: ''\n        });\n      } else {\n        return getImageSize(editor.documentBaseURI.toAbsolute(url)).then(function (dimensions) {\n          return {\n            width: String(dimensions.width),\n            height: String(dimensions.height)\n          };\n        });\n      }\n    };\n  };\n\n  var createBlobCache = function (editor) {\n    return function (file, blobUri, dataUrl) {\n      return editor.editorUpload.blobCache.create({\n        blob: file,\n        blobUri: blobUri,\n        name: file.name ? file.name.replace(/\\.[^\\.]+$/, '') : null,\n        filename: file.name,\n        base64: dataUrl.split(',')[1]\n      });\n    };\n  };\n\n  var addToBlobCache = function (editor) {\n    return function (blobInfo) {\n      editor.editorUpload.blobCache.add(blobInfo);\n    };\n  };\n\n  var alertErr = function (editor) {\n    return function (message) {\n      editor.windowManager.alert(message);\n    };\n  };\n\n  var normalizeCss = function (editor) {\n    return function (cssText) {\n      return normalizeCss$1(editor, cssText);\n    };\n  };\n\n  var parseStyle = function (editor) {\n    return function (cssText) {\n      return editor.dom.parseStyle(cssText);\n    };\n  };\n\n  var serializeStyle = function (editor) {\n    return function (stylesArg, name) {\n      return editor.dom.serializeStyle(stylesArg, name);\n    };\n  };\n\n  var uploadImage = function (editor) {\n    return function (blobInfo) {\n      return global$1(editor).upload([blobInfo], false).then(function (results) {\n        if (results.length === 0) {\n          return global$4.reject('Failed to upload image');\n        } else if (results[0].status === false) {\n          return global$4.reject(results[0].error.message);\n        } else {\n          return results[0];\n        }\n      });\n    };\n  };\n\n  var Dialog = function (editor) {\n    var helpers = {\n      onSubmit: submitHandler(editor),\n      imageSize: imageSize(editor),\n      addToBlobCache: addToBlobCache(editor),\n      createBlobCache: createBlobCache(editor),\n      alertErr: alertErr(editor),\n      normalizeCss: normalizeCss(editor),\n      parseStyle: parseStyle(editor),\n      serializeStyle: serializeStyle(editor),\n      uploadImage: uploadImage(editor)\n    };\n\n    var open = function () {\n      collect(editor).then(makeDialog(helpers)).then(editor.windowManager.open);\n    };\n\n    return {\n      open: open\n    };\n  };\n\n  var register$1 = function (editor) {\n    editor.addCommand('mceImage', Dialog(editor).open);\n    editor.addCommand('mceUpdateImage', function (_ui, data) {\n      editor.undoManager.transact(function () {\n        return insertOrUpdateImage(editor, data);\n      });\n    });\n  };\n\n  var hasImageClass = function (node) {\n    var className = node.attr('class');\n    return className && /\\bimage\\b/.test(className);\n  };\n\n  var toggleContentEditableState = function (state) {\n    return function (nodes) {\n      var i = nodes.length;\n\n      var toggleContentEditable = function (node) {\n        node.attr('contenteditable', state ? 'true' : null);\n      };\n\n      while (i--) {\n        var node = nodes[i];\n\n        if (hasImageClass(node)) {\n          node.attr('contenteditable', state ? 'false' : null);\n          global.each(node.getAll('figcaption'), toggleContentEditable);\n        }\n      }\n    };\n  };\n\n  var setup = function (editor) {\n    editor.on('PreInit', function () {\n      editor.parser.addNodeFilter('figure', toggleContentEditableState(true));\n      editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));\n    });\n  };\n\n  var register = function (editor) {\n    editor.ui.registry.addToggleButton('image', {\n      icon: 'image',\n      tooltip: 'Insert/edit image',\n      onAction: Dialog(editor).open,\n      onSetup: function (buttonApi) {\n        buttonApi.setActive(isNonNullable(getSelectedImage(editor)));\n        return editor.selection.selectorChangedWithUnbind('img:not([data-mce-object],[data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;\n      }\n    });\n    editor.ui.registry.addMenuItem('image', {\n      icon: 'image',\n      text: 'Image...',\n      onAction: Dialog(editor).open\n    });\n    editor.ui.registry.addContextMenu('image', {\n      update: function (element) {\n        return isFigure(element) || isImage(element) && !isPlaceholderImage(element) ? ['image'] : [];\n      }\n    });\n  };\n\n  function Plugin() {\n    global$6.add('image', function (editor) {\n      setup(editor);\n      register(editor);\n      register$1(editor);\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/opt/bitnami/apache/htdocs/converzee-frontend/node_modules/tinymce/plugins/image/plugin.js"],"names":["global$6","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","typeOf","x","Array","isPrototypeOf","constructor","name","String","isType","type","value","isSimpleType","eq","a","isString","isObject","isArray","isNull","isBoolean","isNullable","undefined","isNonNullable","isFunction","isNumber","noop","constant","identity","never","always","none","NONE","thunk","id","me","fold","_s","isSome","isNone","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","toArray","toString","some","constant_a","self","f","from","Optional","keys","obj","props","k","len","objAcc","r","internalFilter","pred","onTrue","onFalse","has","key","hasNonNullableKey","nativePush","push","flatten","xs","get","head","findMap","arr","window","Function","rawSet","dom","setAttribute","console","error","set","element","remove","removeAttribute","fromHtml","html","scope","doc","document","div","createElement","innerHTML","hasChildNodes","childNodes","fromDom","fromTag","tag","node","fromText","text","createTextNode","fromPoint","docElm","y","elementFromPoint","SugarElement","global$5","global$4","global$3","global$2","hasDimensions","editor","getParam","hasAdvTab","hasUploadTab","getPrependUrl","getClassList","hasDescription","hasImageTitle","hasImageCaption","getImageList","hasUploadUrl","hasUploadHandler","showAccessibilityOptions","isAutomaticUploadsEnabled","parseIntAndGetMax","val1","val2","Math","max","parseInt","getImageSize","url","callback","img","done","dimensions","onload","onerror","parentNode","removeChild","width","clientWidth","height","clientHeight","reject","style","visibility","position","bottom","left","body","appendChild","src","removePixelSuffix","replace","addPixelSuffix","test","mergeMargins","css","margin","splitMargin","split","createImageList","imageList","send","success","JSON","parse","waitLoadImage","data","imgElm","selectImage","selection","select","nodeChanged","setAttribs","blobToDataUri","blob","reader","FileReader","result","message","readAsDataURL","isPlaceholderImage","nodeName","hasAttribute","isSafeImageUrl","isDomSafe","settings","DOM","getHspace","image","marginLeft","marginRight","getVspace","marginTop","marginBottom","getBorder","borderWidth","getAttrib","getAttribute","getStyle","hasCaption","updateAttrib","wrapInFigure","figureElm","create","class","insertAfter","contentEditable","removeFigure","toggleCaption","normalizeStyle","normalizeCss","attrValue","setSize","getSize","setHspace","pxValue","setVspace","setBorder","setBorderStyle","borderStyle","getBorderStyle","isFigure","elm","isImage","getIsDecorative","getAlt","defaultData","alt","title","caption","hspace","vspace","border","isDecorative","getStyleValue","write","setAlt","figure","read","updateProp","oldData","newData","setAttrib","sugarImage","updateAlt","normalized","_name","_value","normalizeCss$1","cssText","styles","mergedCss","compressed","serialize","getSelectedImage","getNode","getParent","splitTextBlock","textBlockElements","schema","getTextBlockElements","_","parentElm","isValidChild","textBlock","getBody","readImageDataFromSelection","insertImageAtCaret","focus","setContent","outerHTML","insertedElm","syncSrcAttr","deleteImage","is","isEmpty","setCursorLocation","writeImageDataToSelection","sanitizeImageData","insertOrUpdateImage","partialData","selectedImageData","sanitizedData","deep","old","nu","bothObjects","deepMerge","baseMerge","merger","objects","_i","ret","j","curObject","isNotEmpty","global$1","global","getValue","item","getText","sanitizeList","list","extractValue","out","menu","items","sanitizer","extractor","sanitize","isGroup","findEntryDelegate","findEntry","optList","ListUtils","makeTab$2","_info","label","columns","inputMode","AdvTab","makeTab","collect","urlListSanitizer","convertURL","futureImageList","completer","classList","hasAdvTab$1","hasUploadTab$1","hasUploadUrl$1","hasUploadHandler$1","hasDescription$1","hasImageTitle$1","hasDimensions$1","hasImageCaption$1","hasAccessibilityOptions","automaticUploads","prependURL","preUrl","then","makeItems","info","imageUrl","filetype","imageDescription","disabled","imageTitle","imageDimensions","getDialogContainerType","useColumns","makeTab$1","MainTab","UploadTab","createState","prevImage","prevAlt","open","fromImageData","meta","images","classes","borderstyle","fileinput","toImageData","removeEmptyAlt","addPrependUrl2","srcURL","prependUrl","substring","addPrependUrl","api","getData","setData","formFillFromMeta2","entry","formFillFromMeta","calculateImageSize","helpers","state","imageSize","size","catch","e","updateImagesDropdown","changeSrc","changeImages","calcVSpace","matchingTopBottom","calcHSpace","matchingLeftRight","calcBorderWidth","calcBorderStyle","calcStyle","parseStyle","serializeStyle","changeStyle2","dataCopy","changeStyle","changeAStyle","changeFileInput","block","unblock","file","blobUri","URL","createObjectURL","finalize","revokeObjectURL","updateSrcAndSwitchTab","showTab","dataUrl","blobInfo","createBlobCache","uploadImage","err","alertErr","addToBlobCache","changeHandler","evt","disable","enable","closeHandler","makeDialogBody","tabPanel","tabs","panel","makeDialog","buttons","primary","initialData","onSubmit","onChange","onClose","submitHandler","execCommand","editorUpload","uploadImagesAuto","close","documentBaseURI","toAbsolute","blobCache","filename","base64","add","windowManager","alert","stylesArg","upload","results","status","Dialog","register$1","addCommand","_ui","undoManager","transact","hasImageClass","className","attr","toggleContentEditableState","nodes","toggleContentEditable","getAll","setup","on","parser","addNodeFilter","serializer","register","ui","registry","addToggleButton","icon","tooltip","onAction","onSetup","buttonApi","setActive","selectorChangedWithUnbind","unbind","addMenuItem","addContextMenu","update","Plugin"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.2 (2021-11-17)\n */\n(function () {\n    'use strict';\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var eq = function (t) {\n      return function (a) {\n        return t === a;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNull = eq(null);\n    var isBoolean = isSimpleType('boolean');\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n    var isFunction = isSimpleType('function');\n    var isNumber = isSimpleType('number');\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = identity;\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: function () {\n          return none();\n        },\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var filter = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n    var hasNonNullableKey = function (obj, key) {\n      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n    };\n\n    var nativePush = Array.prototype.push;\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var get = function (xs, i) {\n      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n    };\n    var head = function (xs) {\n      return get(xs, 0);\n    };\n    var findMap = function (arr, f) {\n      for (var i = 0; i < arr.length; i++) {\n        var r = f(arr[i], i);\n        if (r.isSome()) {\n          return r;\n        }\n      }\n      return Optional.none();\n    };\n\n    typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n    var remove = function (element, key) {\n      element.dom.removeAttribute(key);\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.URI');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n    var hasDimensions = function (editor) {\n      return editor.getParam('image_dimensions', true, 'boolean');\n    };\n    var hasAdvTab = function (editor) {\n      return editor.getParam('image_advtab', false, 'boolean');\n    };\n    var hasUploadTab = function (editor) {\n      return editor.getParam('image_uploadtab', true, 'boolean');\n    };\n    var getPrependUrl = function (editor) {\n      return editor.getParam('image_prepend_url', '', 'string');\n    };\n    var getClassList = function (editor) {\n      return editor.getParam('image_class_list');\n    };\n    var hasDescription = function (editor) {\n      return editor.getParam('image_description', true, 'boolean');\n    };\n    var hasImageTitle = function (editor) {\n      return editor.getParam('image_title', false, 'boolean');\n    };\n    var hasImageCaption = function (editor) {\n      return editor.getParam('image_caption', false, 'boolean');\n    };\n    var getImageList = function (editor) {\n      return editor.getParam('image_list', false);\n    };\n    var hasUploadUrl = function (editor) {\n      return isNonNullable(editor.getParam('images_upload_url'));\n    };\n    var hasUploadHandler = function (editor) {\n      return isNonNullable(editor.getParam('images_upload_handler'));\n    };\n    var showAccessibilityOptions = function (editor) {\n      return editor.getParam('a11y_advanced_options', false, 'boolean');\n    };\n    var isAutomaticUploadsEnabled = function (editor) {\n      return editor.getParam('automatic_uploads', true, 'boolean');\n    };\n\n    var parseIntAndGetMax = function (val1, val2) {\n      return Math.max(parseInt(val1, 10), parseInt(val2, 10));\n    };\n    var getImageSize = function (url) {\n      return new global$4(function (callback) {\n        var img = document.createElement('img');\n        var done = function (dimensions) {\n          img.onload = img.onerror = null;\n          if (img.parentNode) {\n            img.parentNode.removeChild(img);\n          }\n          callback(dimensions);\n        };\n        img.onload = function () {\n          var width = parseIntAndGetMax(img.width, img.clientWidth);\n          var height = parseIntAndGetMax(img.height, img.clientHeight);\n          var dimensions = {\n            width: width,\n            height: height\n          };\n          done(global$4.resolve(dimensions));\n        };\n        img.onerror = function () {\n          done(global$4.reject('Failed to get image dimensions for: ' + url));\n        };\n        var style = img.style;\n        style.visibility = 'hidden';\n        style.position = 'fixed';\n        style.bottom = style.left = '0px';\n        style.width = style.height = 'auto';\n        document.body.appendChild(img);\n        img.src = url;\n      });\n    };\n    var removePixelSuffix = function (value) {\n      if (value) {\n        value = value.replace(/px$/, '');\n      }\n      return value;\n    };\n    var addPixelSuffix = function (value) {\n      if (value.length > 0 && /^[0-9]+$/.test(value)) {\n        value += 'px';\n      }\n      return value;\n    };\n    var mergeMargins = function (css) {\n      if (css.margin) {\n        var splitMargin = String(css.margin).split(' ');\n        switch (splitMargin.length) {\n        case 1:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[0];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[0];\n          break;\n        case 2:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n        case 3:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n        case 4:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[3];\n        }\n        delete css.margin;\n      }\n      return css;\n    };\n    var createImageList = function (editor, callback) {\n      var imageList = getImageList(editor);\n      if (isString(imageList)) {\n        global$2.send({\n          url: imageList,\n          success: function (text) {\n            callback(JSON.parse(text));\n          }\n        });\n      } else if (isFunction(imageList)) {\n        imageList(callback);\n      } else {\n        callback(imageList);\n      }\n    };\n    var waitLoadImage = function (editor, data, imgElm) {\n      var selectImage = function () {\n        imgElm.onload = imgElm.onerror = null;\n        if (editor.selection) {\n          editor.selection.select(imgElm);\n          editor.nodeChanged();\n        }\n      };\n      imgElm.onload = function () {\n        if (!data.width && !data.height && hasDimensions(editor)) {\n          editor.dom.setAttribs(imgElm, {\n            width: String(imgElm.clientWidth),\n            height: String(imgElm.clientHeight)\n          });\n        }\n        selectImage();\n      };\n      imgElm.onerror = selectImage;\n    };\n    var blobToDataUri = function (blob) {\n      return new global$4(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          resolve(reader.result);\n        };\n        reader.onerror = function () {\n          reject(reader.error.message);\n        };\n        reader.readAsDataURL(blob);\n      });\n    };\n    var isPlaceholderImage = function (imgElm) {\n      return imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));\n    };\n    var isSafeImageUrl = function (editor, src) {\n      return global$3.isDomSafe(src, 'img', editor.settings);\n    };\n\n    var DOM = global$5.DOM;\n    var getHspace = function (image) {\n      if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {\n        return removePixelSuffix(image.style.marginLeft);\n      } else {\n        return '';\n      }\n    };\n    var getVspace = function (image) {\n      if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {\n        return removePixelSuffix(image.style.marginTop);\n      } else {\n        return '';\n      }\n    };\n    var getBorder = function (image) {\n      if (image.style.borderWidth) {\n        return removePixelSuffix(image.style.borderWidth);\n      } else {\n        return '';\n      }\n    };\n    var getAttrib = function (image, name) {\n      if (image.hasAttribute(name)) {\n        return image.getAttribute(name);\n      } else {\n        return '';\n      }\n    };\n    var getStyle = function (image, name) {\n      return image.style[name] ? image.style[name] : '';\n    };\n    var hasCaption = function (image) {\n      return image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';\n    };\n    var updateAttrib = function (image, name, value) {\n      if (value === '') {\n        image.removeAttribute(name);\n      } else {\n        image.setAttribute(name, value);\n      }\n    };\n    var wrapInFigure = function (image) {\n      var figureElm = DOM.create('figure', { class: 'image' });\n      DOM.insertAfter(figureElm, image);\n      figureElm.appendChild(image);\n      figureElm.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));\n      figureElm.contentEditable = 'false';\n    };\n    var removeFigure = function (image) {\n      var figureElm = image.parentNode;\n      DOM.insertAfter(image, figureElm);\n      DOM.remove(figureElm);\n    };\n    var toggleCaption = function (image) {\n      if (hasCaption(image)) {\n        removeFigure(image);\n      } else {\n        wrapInFigure(image);\n      }\n    };\n    var normalizeStyle = function (image, normalizeCss) {\n      var attrValue = image.getAttribute('style');\n      var value = normalizeCss(attrValue !== null ? attrValue : '');\n      if (value.length > 0) {\n        image.setAttribute('style', value);\n        image.setAttribute('data-mce-style', value);\n      } else {\n        image.removeAttribute('style');\n      }\n    };\n    var setSize = function (name, normalizeCss) {\n      return function (image, name, value) {\n        if (image.style[name]) {\n          image.style[name] = addPixelSuffix(value);\n          normalizeStyle(image, normalizeCss);\n        } else {\n          updateAttrib(image, name, value);\n        }\n      };\n    };\n    var getSize = function (image, name) {\n      if (image.style[name]) {\n        return removePixelSuffix(image.style[name]);\n      } else {\n        return getAttrib(image, name);\n      }\n    };\n    var setHspace = function (image, value) {\n      var pxValue = addPixelSuffix(value);\n      image.style.marginLeft = pxValue;\n      image.style.marginRight = pxValue;\n    };\n    var setVspace = function (image, value) {\n      var pxValue = addPixelSuffix(value);\n      image.style.marginTop = pxValue;\n      image.style.marginBottom = pxValue;\n    };\n    var setBorder = function (image, value) {\n      var pxValue = addPixelSuffix(value);\n      image.style.borderWidth = pxValue;\n    };\n    var setBorderStyle = function (image, value) {\n      image.style.borderStyle = value;\n    };\n    var getBorderStyle = function (image) {\n      return getStyle(image, 'borderStyle');\n    };\n    var isFigure = function (elm) {\n      return elm.nodeName === 'FIGURE';\n    };\n    var isImage = function (elm) {\n      return elm.nodeName === 'IMG';\n    };\n    var getIsDecorative = function (image) {\n      return DOM.getAttrib(image, 'alt').length === 0 && DOM.getAttrib(image, 'role') === 'presentation';\n    };\n    var getAlt = function (image) {\n      if (getIsDecorative(image)) {\n        return '';\n      } else {\n        return getAttrib(image, 'alt');\n      }\n    };\n    var defaultData = function () {\n      return {\n        src: '',\n        alt: '',\n        title: '',\n        width: '',\n        height: '',\n        class: '',\n        style: '',\n        caption: false,\n        hspace: '',\n        vspace: '',\n        border: '',\n        borderStyle: '',\n        isDecorative: false\n      };\n    };\n    var getStyleValue = function (normalizeCss, data) {\n      var image = document.createElement('img');\n      updateAttrib(image, 'style', data.style);\n      if (getHspace(image) || data.hspace !== '') {\n        setHspace(image, data.hspace);\n      }\n      if (getVspace(image) || data.vspace !== '') {\n        setVspace(image, data.vspace);\n      }\n      if (getBorder(image) || data.border !== '') {\n        setBorder(image, data.border);\n      }\n      if (getBorderStyle(image) || data.borderStyle !== '') {\n        setBorderStyle(image, data.borderStyle);\n      }\n      return normalizeCss(image.getAttribute('style'));\n    };\n    var create = function (normalizeCss, data) {\n      var image = document.createElement('img');\n      write(normalizeCss, __assign(__assign({}, data), { caption: false }), image);\n      setAlt(image, data.alt, data.isDecorative);\n      if (data.caption) {\n        var figure = DOM.create('figure', { class: 'image' });\n        figure.appendChild(image);\n        figure.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));\n        figure.contentEditable = 'false';\n        return figure;\n      } else {\n        return image;\n      }\n    };\n    var read = function (normalizeCss, image) {\n      return {\n        src: getAttrib(image, 'src'),\n        alt: getAlt(image),\n        title: getAttrib(image, 'title'),\n        width: getSize(image, 'width'),\n        height: getSize(image, 'height'),\n        class: getAttrib(image, 'class'),\n        style: normalizeCss(getAttrib(image, 'style')),\n        caption: hasCaption(image),\n        hspace: getHspace(image),\n        vspace: getVspace(image),\n        border: getBorder(image),\n        borderStyle: getStyle(image, 'borderStyle'),\n        isDecorative: getIsDecorative(image)\n      };\n    };\n    var updateProp = function (image, oldData, newData, name, set) {\n      if (newData[name] !== oldData[name]) {\n        set(image, name, newData[name]);\n      }\n    };\n    var setAlt = function (image, alt, isDecorative) {\n      if (isDecorative) {\n        DOM.setAttrib(image, 'role', 'presentation');\n        var sugarImage = SugarElement.fromDom(image);\n        set(sugarImage, 'alt', '');\n      } else {\n        if (isNull(alt)) {\n          var sugarImage = SugarElement.fromDom(image);\n          remove(sugarImage, 'alt');\n        } else {\n          var sugarImage = SugarElement.fromDom(image);\n          set(sugarImage, 'alt', alt);\n        }\n        if (DOM.getAttrib(image, 'role') === 'presentation') {\n          DOM.setAttrib(image, 'role', '');\n        }\n      }\n    };\n    var updateAlt = function (image, oldData, newData) {\n      if (newData.alt !== oldData.alt || newData.isDecorative !== oldData.isDecorative) {\n        setAlt(image, newData.alt, newData.isDecorative);\n      }\n    };\n    var normalized = function (set, normalizeCss) {\n      return function (image, name, value) {\n        set(image, value);\n        normalizeStyle(image, normalizeCss);\n      };\n    };\n    var write = function (normalizeCss, newData, image) {\n      var oldData = read(normalizeCss, image);\n      updateProp(image, oldData, newData, 'caption', function (image, _name, _value) {\n        return toggleCaption(image);\n      });\n      updateProp(image, oldData, newData, 'src', updateAttrib);\n      updateProp(image, oldData, newData, 'title', updateAttrib);\n      updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));\n      updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));\n      updateProp(image, oldData, newData, 'class', updateAttrib);\n      updateProp(image, oldData, newData, 'style', normalized(function (image, value) {\n        return updateAttrib(image, 'style', value);\n      }, normalizeCss));\n      updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));\n      updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));\n      updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));\n      updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));\n      updateAlt(image, oldData, newData);\n    };\n\n    var normalizeCss$1 = function (editor, cssText) {\n      var css = editor.dom.styles.parse(cssText);\n      var mergedCss = mergeMargins(css);\n      var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));\n      return editor.dom.styles.serialize(compressed);\n    };\n    var getSelectedImage = function (editor) {\n      var imgElm = editor.selection.getNode();\n      var figureElm = editor.dom.getParent(imgElm, 'figure.image');\n      if (figureElm) {\n        return editor.dom.select('img', figureElm)[0];\n      }\n      if (imgElm && (imgElm.nodeName !== 'IMG' || isPlaceholderImage(imgElm))) {\n        return null;\n      }\n      return imgElm;\n    };\n    var splitTextBlock = function (editor, figure) {\n      var dom = editor.dom;\n      var textBlockElements = filter(editor.schema.getTextBlockElements(), function (_, parentElm) {\n        return !editor.schema.isValidChild(parentElm, 'figure');\n      });\n      var textBlock = dom.getParent(figure.parentNode, function (node) {\n        return hasNonNullableKey(textBlockElements, node.nodeName);\n      }, editor.getBody());\n      if (textBlock) {\n        return dom.split(textBlock, figure);\n      } else {\n        return figure;\n      }\n    };\n    var readImageDataFromSelection = function (editor) {\n      var image = getSelectedImage(editor);\n      return image ? read(function (css) {\n        return normalizeCss$1(editor, css);\n      }, image) : defaultData();\n    };\n    var insertImageAtCaret = function (editor, data) {\n      var elm = create(function (css) {\n        return normalizeCss$1(editor, css);\n      }, data);\n      editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');\n      editor.focus();\n      editor.selection.setContent(elm.outerHTML);\n      var insertedElm = editor.dom.select('*[data-mce-id=\"__mcenew\"]')[0];\n      editor.dom.setAttrib(insertedElm, 'data-mce-id', null);\n      if (isFigure(insertedElm)) {\n        var figure = splitTextBlock(editor, insertedElm);\n        editor.selection.select(figure);\n      } else {\n        editor.selection.select(insertedElm);\n      }\n    };\n    var syncSrcAttr = function (editor, image) {\n      editor.dom.setAttrib(image, 'src', image.getAttribute('src'));\n    };\n    var deleteImage = function (editor, image) {\n      if (image) {\n        var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;\n        editor.dom.remove(elm);\n        editor.focus();\n        editor.nodeChanged();\n        if (editor.dom.isEmpty(editor.getBody())) {\n          editor.setContent('');\n          editor.selection.setCursorLocation();\n        }\n      }\n    };\n    var writeImageDataToSelection = function (editor, data) {\n      var image = getSelectedImage(editor);\n      write(function (css) {\n        return normalizeCss$1(editor, css);\n      }, data, image);\n      syncSrcAttr(editor, image);\n      if (isFigure(image.parentNode)) {\n        var figure = image.parentNode;\n        splitTextBlock(editor, figure);\n        editor.selection.select(image.parentNode);\n      } else {\n        editor.selection.select(image);\n        waitLoadImage(editor, data, image);\n      }\n    };\n    var sanitizeImageData = function (editor, data) {\n      var src = data.src;\n      return __assign(__assign({}, data), { src: isSafeImageUrl(editor, src) ? src : '' });\n    };\n    var insertOrUpdateImage = function (editor, partialData) {\n      var image = getSelectedImage(editor);\n      if (image) {\n        var selectedImageData = read(function (css) {\n          return normalizeCss$1(editor, css);\n        }, image);\n        var data = __assign(__assign({}, selectedImageData), partialData);\n        var sanitizedData = sanitizeImageData(editor, data);\n        if (data.src) {\n          writeImageDataToSelection(editor, sanitizedData);\n        } else {\n          deleteImage(editor, image);\n        }\n      } else if (partialData.src) {\n        insertImageAtCaret(editor, __assign(__assign({}, defaultData()), partialData));\n      }\n    };\n\n    var deep = function (old, nu) {\n      var bothObjects = isObject(old) && isObject(nu);\n      return bothObjects ? deepMerge(old, nu) : nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          objects[_i] = arguments[_i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (has(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var deepMerge = baseMerge(deep);\n\n    var isNotEmpty = function (s) {\n      return s.length > 0;\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.ImageUploader');\n\n    var global = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var getValue = function (item) {\n      return isString(item.value) ? item.value : '';\n    };\n    var getText = function (item) {\n      if (isString(item.text)) {\n        return item.text;\n      } else if (isString(item.title)) {\n        return item.title;\n      } else {\n        return '';\n      }\n    };\n    var sanitizeList = function (list, extractValue) {\n      var out = [];\n      global.each(list, function (item) {\n        var text = getText(item);\n        if (item.menu !== undefined) {\n          var items = sanitizeList(item.menu, extractValue);\n          out.push({\n            text: text,\n            items: items\n          });\n        } else {\n          var value = extractValue(item);\n          out.push({\n            text: text,\n            value: value\n          });\n        }\n      });\n      return out;\n    };\n    var sanitizer = function (extractor) {\n      if (extractor === void 0) {\n        extractor = getValue;\n      }\n      return function (list) {\n        if (list) {\n          return Optional.from(list).map(function (list) {\n            return sanitizeList(list, extractor);\n          });\n        } else {\n          return Optional.none();\n        }\n      };\n    };\n    var sanitize = function (list) {\n      return sanitizer(getValue)(list);\n    };\n    var isGroup = function (item) {\n      return has(item, 'items');\n    };\n    var findEntryDelegate = function (list, value) {\n      return findMap(list, function (item) {\n        if (isGroup(item)) {\n          return findEntryDelegate(item.items, value);\n        } else if (item.value === value) {\n          return Optional.some(item);\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n    var findEntry = function (optList, value) {\n      return optList.bind(function (list) {\n        return findEntryDelegate(list, value);\n      });\n    };\n    var ListUtils = {\n      sanitizer: sanitizer,\n      sanitize: sanitize,\n      findEntry: findEntry\n    };\n\n    var makeTab$2 = function (_info) {\n      return {\n        title: 'Advanced',\n        name: 'advanced',\n        items: [\n          {\n            type: 'input',\n            label: 'Style',\n            name: 'style'\n          },\n          {\n            type: 'grid',\n            columns: 2,\n            items: [\n              {\n                type: 'input',\n                label: 'Vertical space',\n                name: 'vspace',\n                inputMode: 'numeric'\n              },\n              {\n                type: 'input',\n                label: 'Horizontal space',\n                name: 'hspace',\n                inputMode: 'numeric'\n              },\n              {\n                type: 'input',\n                label: 'Border width',\n                name: 'border',\n                inputMode: 'numeric'\n              },\n              {\n                type: 'listbox',\n                name: 'borderstyle',\n                label: 'Border style',\n                items: [\n                  {\n                    text: 'Select...',\n                    value: ''\n                  },\n                  {\n                    text: 'Solid',\n                    value: 'solid'\n                  },\n                  {\n                    text: 'Dotted',\n                    value: 'dotted'\n                  },\n                  {\n                    text: 'Dashed',\n                    value: 'dashed'\n                  },\n                  {\n                    text: 'Double',\n                    value: 'double'\n                  },\n                  {\n                    text: 'Groove',\n                    value: 'groove'\n                  },\n                  {\n                    text: 'Ridge',\n                    value: 'ridge'\n                  },\n                  {\n                    text: 'Inset',\n                    value: 'inset'\n                  },\n                  {\n                    text: 'Outset',\n                    value: 'outset'\n                  },\n                  {\n                    text: 'None',\n                    value: 'none'\n                  },\n                  {\n                    text: 'Hidden',\n                    value: 'hidden'\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      };\n    };\n    var AdvTab = { makeTab: makeTab$2 };\n\n    var collect = function (editor) {\n      var urlListSanitizer = ListUtils.sanitizer(function (item) {\n        return editor.convertURL(item.value || item.url, 'src');\n      });\n      var futureImageList = new global$4(function (completer) {\n        createImageList(editor, function (imageList) {\n          completer(urlListSanitizer(imageList).map(function (items) {\n            return flatten([\n              [{\n                  text: 'None',\n                  value: ''\n                }],\n              items\n            ]);\n          }));\n        });\n      });\n      var classList = ListUtils.sanitize(getClassList(editor));\n      var hasAdvTab$1 = hasAdvTab(editor);\n      var hasUploadTab$1 = hasUploadTab(editor);\n      var hasUploadUrl$1 = hasUploadUrl(editor);\n      var hasUploadHandler$1 = hasUploadHandler(editor);\n      var image = readImageDataFromSelection(editor);\n      var hasDescription$1 = hasDescription(editor);\n      var hasImageTitle$1 = hasImageTitle(editor);\n      var hasDimensions$1 = hasDimensions(editor);\n      var hasImageCaption$1 = hasImageCaption(editor);\n      var hasAccessibilityOptions = showAccessibilityOptions(editor);\n      var automaticUploads = isAutomaticUploadsEnabled(editor);\n      var prependURL = Optional.some(getPrependUrl(editor)).filter(function (preUrl) {\n        return isString(preUrl) && preUrl.length > 0;\n      });\n      return futureImageList.then(function (imageList) {\n        return {\n          image: image,\n          imageList: imageList,\n          classList: classList,\n          hasAdvTab: hasAdvTab$1,\n          hasUploadTab: hasUploadTab$1,\n          hasUploadUrl: hasUploadUrl$1,\n          hasUploadHandler: hasUploadHandler$1,\n          hasDescription: hasDescription$1,\n          hasImageTitle: hasImageTitle$1,\n          hasDimensions: hasDimensions$1,\n          hasImageCaption: hasImageCaption$1,\n          prependURL: prependURL,\n          hasAccessibilityOptions: hasAccessibilityOptions,\n          automaticUploads: automaticUploads\n        };\n      });\n    };\n\n    var makeItems = function (info) {\n      var imageUrl = {\n        name: 'src',\n        type: 'urlinput',\n        filetype: 'image',\n        label: 'Source'\n      };\n      var imageList = info.imageList.map(function (items) {\n        return {\n          name: 'images',\n          type: 'listbox',\n          label: 'Image list',\n          items: items\n        };\n      });\n      var imageDescription = {\n        name: 'alt',\n        type: 'input',\n        label: 'Alternative description',\n        disabled: info.hasAccessibilityOptions && info.image.isDecorative\n      };\n      var imageTitle = {\n        name: 'title',\n        type: 'input',\n        label: 'Image title'\n      };\n      var imageDimensions = {\n        name: 'dimensions',\n        type: 'sizeinput'\n      };\n      var isDecorative = {\n        type: 'label',\n        label: 'Accessibility',\n        items: [{\n            name: 'isDecorative',\n            type: 'checkbox',\n            label: 'Image is decorative'\n          }]\n      };\n      var classList = info.classList.map(function (items) {\n        return {\n          name: 'classes',\n          type: 'listbox',\n          label: 'Class',\n          items: items\n        };\n      });\n      var caption = {\n        type: 'label',\n        label: 'Caption',\n        items: [{\n            type: 'checkbox',\n            name: 'caption',\n            label: 'Show caption'\n          }]\n      };\n      var getDialogContainerType = function (useColumns) {\n        return useColumns ? {\n          type: 'grid',\n          columns: 2\n        } : { type: 'panel' };\n      };\n      return flatten([\n        [imageUrl],\n        imageList.toArray(),\n        info.hasAccessibilityOptions && info.hasDescription ? [isDecorative] : [],\n        info.hasDescription ? [imageDescription] : [],\n        info.hasImageTitle ? [imageTitle] : [],\n        info.hasDimensions ? [imageDimensions] : [],\n        [__assign(__assign({}, getDialogContainerType(info.classList.isSome() && info.hasImageCaption)), {\n            items: flatten([\n              classList.toArray(),\n              info.hasImageCaption ? [caption] : []\n            ])\n          })]\n      ]);\n    };\n    var makeTab$1 = function (info) {\n      return {\n        title: 'General',\n        name: 'general',\n        items: makeItems(info)\n      };\n    };\n    var MainTab = {\n      makeTab: makeTab$1,\n      makeItems: makeItems\n    };\n\n    var makeTab = function (_info) {\n      var items = [{\n          type: 'dropzone',\n          name: 'fileinput'\n        }];\n      return {\n        title: 'Upload',\n        name: 'upload',\n        items: items\n      };\n    };\n    var UploadTab = { makeTab: makeTab };\n\n    var createState = function (info) {\n      return {\n        prevImage: ListUtils.findEntry(info.imageList, info.image.src),\n        prevAlt: info.image.alt,\n        open: true\n      };\n    };\n    var fromImageData = function (image) {\n      return {\n        src: {\n          value: image.src,\n          meta: {}\n        },\n        images: image.src,\n        alt: image.alt,\n        title: image.title,\n        dimensions: {\n          width: image.width,\n          height: image.height\n        },\n        classes: image.class,\n        caption: image.caption,\n        style: image.style,\n        vspace: image.vspace,\n        border: image.border,\n        hspace: image.hspace,\n        borderstyle: image.borderStyle,\n        fileinput: [],\n        isDecorative: image.isDecorative\n      };\n    };\n    var toImageData = function (data, removeEmptyAlt) {\n      return {\n        src: data.src.value,\n        alt: data.alt.length === 0 && removeEmptyAlt ? null : data.alt,\n        title: data.title,\n        width: data.dimensions.width,\n        height: data.dimensions.height,\n        class: data.classes,\n        style: data.style,\n        caption: data.caption,\n        hspace: data.hspace,\n        vspace: data.vspace,\n        border: data.border,\n        borderStyle: data.borderstyle,\n        isDecorative: data.isDecorative\n      };\n    };\n    var addPrependUrl2 = function (info, srcURL) {\n      if (!/^(?:[a-zA-Z]+:)?\\/\\//.test(srcURL)) {\n        return info.prependURL.bind(function (prependUrl) {\n          if (srcURL.substring(0, prependUrl.length) !== prependUrl) {\n            return Optional.some(prependUrl + srcURL);\n          }\n          return Optional.none();\n        });\n      }\n      return Optional.none();\n    };\n    var addPrependUrl = function (info, api) {\n      var data = api.getData();\n      addPrependUrl2(info, data.src.value).each(function (srcURL) {\n        api.setData({\n          src: {\n            value: srcURL,\n            meta: data.src.meta\n          }\n        });\n      });\n    };\n    var formFillFromMeta2 = function (info, data, meta) {\n      if (info.hasDescription && isString(meta.alt)) {\n        data.alt = meta.alt;\n      }\n      if (info.hasAccessibilityOptions) {\n        data.isDecorative = meta.isDecorative || data.isDecorative || false;\n      }\n      if (info.hasImageTitle && isString(meta.title)) {\n        data.title = meta.title;\n      }\n      if (info.hasDimensions) {\n        if (isString(meta.width)) {\n          data.dimensions.width = meta.width;\n        }\n        if (isString(meta.height)) {\n          data.dimensions.height = meta.height;\n        }\n      }\n      if (isString(meta.class)) {\n        ListUtils.findEntry(info.classList, meta.class).each(function (entry) {\n          data.classes = entry.value;\n        });\n      }\n      if (info.hasImageCaption) {\n        if (isBoolean(meta.caption)) {\n          data.caption = meta.caption;\n        }\n      }\n      if (info.hasAdvTab) {\n        if (isString(meta.style)) {\n          data.style = meta.style;\n        }\n        if (isString(meta.vspace)) {\n          data.vspace = meta.vspace;\n        }\n        if (isString(meta.border)) {\n          data.border = meta.border;\n        }\n        if (isString(meta.hspace)) {\n          data.hspace = meta.hspace;\n        }\n        if (isString(meta.borderstyle)) {\n          data.borderstyle = meta.borderstyle;\n        }\n      }\n    };\n    var formFillFromMeta = function (info, api) {\n      var data = api.getData();\n      var meta = data.src.meta;\n      if (meta !== undefined) {\n        var newData = deepMerge({}, data);\n        formFillFromMeta2(info, newData, meta);\n        api.setData(newData);\n      }\n    };\n    var calculateImageSize = function (helpers, info, state, api) {\n      var data = api.getData();\n      var url = data.src.value;\n      var meta = data.src.meta || {};\n      if (!meta.width && !meta.height && info.hasDimensions) {\n        if (isNotEmpty(url)) {\n          helpers.imageSize(url).then(function (size) {\n            if (state.open) {\n              api.setData({ dimensions: size });\n            }\n          }).catch(function (e) {\n            return console.error(e);\n          });\n        } else {\n          api.setData({\n            dimensions: {\n              width: '',\n              height: ''\n            }\n          });\n        }\n      }\n    };\n    var updateImagesDropdown = function (info, state, api) {\n      var data = api.getData();\n      var image = ListUtils.findEntry(info.imageList, data.src.value);\n      state.prevImage = image;\n      api.setData({\n        images: image.map(function (entry) {\n          return entry.value;\n        }).getOr('')\n      });\n    };\n    var changeSrc = function (helpers, info, state, api) {\n      addPrependUrl(info, api);\n      formFillFromMeta(info, api);\n      calculateImageSize(helpers, info, state, api);\n      updateImagesDropdown(info, state, api);\n    };\n    var changeImages = function (helpers, info, state, api) {\n      var data = api.getData();\n      var image = ListUtils.findEntry(info.imageList, data.images);\n      image.each(function (img) {\n        var updateAlt = data.alt === '' || state.prevImage.map(function (image) {\n          return image.text === data.alt;\n        }).getOr(false);\n        if (updateAlt) {\n          if (img.value === '') {\n            api.setData({\n              src: img,\n              alt: state.prevAlt\n            });\n          } else {\n            api.setData({\n              src: img,\n              alt: img.text\n            });\n          }\n        } else {\n          api.setData({ src: img });\n        }\n      });\n      state.prevImage = image;\n      changeSrc(helpers, info, state, api);\n    };\n    var calcVSpace = function (css) {\n      var matchingTopBottom = css['margin-top'] && css['margin-bottom'] && css['margin-top'] === css['margin-bottom'];\n      return matchingTopBottom ? removePixelSuffix(String(css['margin-top'])) : '';\n    };\n    var calcHSpace = function (css) {\n      var matchingLeftRight = css['margin-right'] && css['margin-left'] && css['margin-right'] === css['margin-left'];\n      return matchingLeftRight ? removePixelSuffix(String(css['margin-right'])) : '';\n    };\n    var calcBorderWidth = function (css) {\n      return css['border-width'] ? removePixelSuffix(String(css['border-width'])) : '';\n    };\n    var calcBorderStyle = function (css) {\n      return css['border-style'] ? String(css['border-style']) : '';\n    };\n    var calcStyle = function (parseStyle, serializeStyle, css) {\n      return serializeStyle(parseStyle(serializeStyle(css)));\n    };\n    var changeStyle2 = function (parseStyle, serializeStyle, data) {\n      var css = mergeMargins(parseStyle(data.style));\n      var dataCopy = deepMerge({}, data);\n      dataCopy.vspace = calcVSpace(css);\n      dataCopy.hspace = calcHSpace(css);\n      dataCopy.border = calcBorderWidth(css);\n      dataCopy.borderstyle = calcBorderStyle(css);\n      dataCopy.style = calcStyle(parseStyle, serializeStyle, css);\n      return dataCopy;\n    };\n    var changeStyle = function (helpers, api) {\n      var data = api.getData();\n      var newData = changeStyle2(helpers.parseStyle, helpers.serializeStyle, data);\n      api.setData(newData);\n    };\n    var changeAStyle = function (helpers, info, api) {\n      var data = deepMerge(fromImageData(info.image), api.getData());\n      var style = getStyleValue(helpers.normalizeCss, toImageData(data, false));\n      api.setData({ style: style });\n    };\n    var changeFileInput = function (helpers, info, state, api) {\n      var data = api.getData();\n      api.block('Uploading image');\n      head(data.fileinput).fold(function () {\n        api.unblock();\n      }, function (file) {\n        var blobUri = URL.createObjectURL(file);\n        var finalize = function () {\n          api.unblock();\n          URL.revokeObjectURL(blobUri);\n        };\n        var updateSrcAndSwitchTab = function (url) {\n          api.setData({\n            src: {\n              value: url,\n              meta: {}\n            }\n          });\n          api.showTab('general');\n          changeSrc(helpers, info, state, api);\n        };\n        blobToDataUri(file).then(function (dataUrl) {\n          var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);\n          if (info.automaticUploads) {\n            helpers.uploadImage(blobInfo).then(function (result) {\n              updateSrcAndSwitchTab(result.url);\n              finalize();\n            }).catch(function (err) {\n              finalize();\n              helpers.alertErr(err);\n            });\n          } else {\n            helpers.addToBlobCache(blobInfo);\n            updateSrcAndSwitchTab(blobInfo.blobUri());\n            api.unblock();\n          }\n        });\n      });\n    };\n    var changeHandler = function (helpers, info, state) {\n      return function (api, evt) {\n        if (evt.name === 'src') {\n          changeSrc(helpers, info, state, api);\n        } else if (evt.name === 'images') {\n          changeImages(helpers, info, state, api);\n        } else if (evt.name === 'alt') {\n          state.prevAlt = api.getData().alt;\n        } else if (evt.name === 'style') {\n          changeStyle(helpers, api);\n        } else if (evt.name === 'vspace' || evt.name === 'hspace' || evt.name === 'border' || evt.name === 'borderstyle') {\n          changeAStyle(helpers, info, api);\n        } else if (evt.name === 'fileinput') {\n          changeFileInput(helpers, info, state, api);\n        } else if (evt.name === 'isDecorative') {\n          if (api.getData().isDecorative) {\n            api.disable('alt');\n          } else {\n            api.enable('alt');\n          }\n        }\n      };\n    };\n    var closeHandler = function (state) {\n      return function () {\n        state.open = false;\n      };\n    };\n    var makeDialogBody = function (info) {\n      if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {\n        var tabPanel = {\n          type: 'tabpanel',\n          tabs: flatten([\n            [MainTab.makeTab(info)],\n            info.hasAdvTab ? [AdvTab.makeTab(info)] : [],\n            info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []\n          ])\n        };\n        return tabPanel;\n      } else {\n        var panel = {\n          type: 'panel',\n          items: MainTab.makeItems(info)\n        };\n        return panel;\n      }\n    };\n    var makeDialog = function (helpers) {\n      return function (info) {\n        var state = createState(info);\n        return {\n          title: 'Insert/Edit Image',\n          size: 'normal',\n          body: makeDialogBody(info),\n          buttons: [\n            {\n              type: 'cancel',\n              name: 'cancel',\n              text: 'Cancel'\n            },\n            {\n              type: 'submit',\n              name: 'save',\n              text: 'Save',\n              primary: true\n            }\n          ],\n          initialData: fromImageData(info.image),\n          onSubmit: helpers.onSubmit(info),\n          onChange: changeHandler(helpers, info, state),\n          onClose: closeHandler(state)\n        };\n      };\n    };\n    var submitHandler = function (editor) {\n      return function (info) {\n        return function (api) {\n          var data = deepMerge(fromImageData(info.image), api.getData());\n          editor.execCommand('mceUpdateImage', false, toImageData(data, info.hasAccessibilityOptions));\n          editor.editorUpload.uploadImagesAuto();\n          api.close();\n        };\n      };\n    };\n    var imageSize = function (editor) {\n      return function (url) {\n        if (!isSafeImageUrl(editor, url)) {\n          return global$4.resolve({\n            width: '',\n            height: ''\n          });\n        } else {\n          return getImageSize(editor.documentBaseURI.toAbsolute(url)).then(function (dimensions) {\n            return {\n              width: String(dimensions.width),\n              height: String(dimensions.height)\n            };\n          });\n        }\n      };\n    };\n    var createBlobCache = function (editor) {\n      return function (file, blobUri, dataUrl) {\n        return editor.editorUpload.blobCache.create({\n          blob: file,\n          blobUri: blobUri,\n          name: file.name ? file.name.replace(/\\.[^\\.]+$/, '') : null,\n          filename: file.name,\n          base64: dataUrl.split(',')[1]\n        });\n      };\n    };\n    var addToBlobCache = function (editor) {\n      return function (blobInfo) {\n        editor.editorUpload.blobCache.add(blobInfo);\n      };\n    };\n    var alertErr = function (editor) {\n      return function (message) {\n        editor.windowManager.alert(message);\n      };\n    };\n    var normalizeCss = function (editor) {\n      return function (cssText) {\n        return normalizeCss$1(editor, cssText);\n      };\n    };\n    var parseStyle = function (editor) {\n      return function (cssText) {\n        return editor.dom.parseStyle(cssText);\n      };\n    };\n    var serializeStyle = function (editor) {\n      return function (stylesArg, name) {\n        return editor.dom.serializeStyle(stylesArg, name);\n      };\n    };\n    var uploadImage = function (editor) {\n      return function (blobInfo) {\n        return global$1(editor).upload([blobInfo], false).then(function (results) {\n          if (results.length === 0) {\n            return global$4.reject('Failed to upload image');\n          } else if (results[0].status === false) {\n            return global$4.reject(results[0].error.message);\n          } else {\n            return results[0];\n          }\n        });\n      };\n    };\n    var Dialog = function (editor) {\n      var helpers = {\n        onSubmit: submitHandler(editor),\n        imageSize: imageSize(editor),\n        addToBlobCache: addToBlobCache(editor),\n        createBlobCache: createBlobCache(editor),\n        alertErr: alertErr(editor),\n        normalizeCss: normalizeCss(editor),\n        parseStyle: parseStyle(editor),\n        serializeStyle: serializeStyle(editor),\n        uploadImage: uploadImage(editor)\n      };\n      var open = function () {\n        collect(editor).then(makeDialog(helpers)).then(editor.windowManager.open);\n      };\n      return { open: open };\n    };\n\n    var register$1 = function (editor) {\n      editor.addCommand('mceImage', Dialog(editor).open);\n      editor.addCommand('mceUpdateImage', function (_ui, data) {\n        editor.undoManager.transact(function () {\n          return insertOrUpdateImage(editor, data);\n        });\n      });\n    };\n\n    var hasImageClass = function (node) {\n      var className = node.attr('class');\n      return className && /\\bimage\\b/.test(className);\n    };\n    var toggleContentEditableState = function (state) {\n      return function (nodes) {\n        var i = nodes.length;\n        var toggleContentEditable = function (node) {\n          node.attr('contenteditable', state ? 'true' : null);\n        };\n        while (i--) {\n          var node = nodes[i];\n          if (hasImageClass(node)) {\n            node.attr('contenteditable', state ? 'false' : null);\n            global.each(node.getAll('figcaption'), toggleContentEditable);\n          }\n        }\n      };\n    };\n    var setup = function (editor) {\n      editor.on('PreInit', function () {\n        editor.parser.addNodeFilter('figure', toggleContentEditableState(true));\n        editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));\n      });\n    };\n\n    var register = function (editor) {\n      editor.ui.registry.addToggleButton('image', {\n        icon: 'image',\n        tooltip: 'Insert/edit image',\n        onAction: Dialog(editor).open,\n        onSetup: function (buttonApi) {\n          buttonApi.setActive(isNonNullable(getSelectedImage(editor)));\n          return editor.selection.selectorChangedWithUnbind('img:not([data-mce-object],[data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;\n        }\n      });\n      editor.ui.registry.addMenuItem('image', {\n        icon: 'image',\n        text: 'Image...',\n        onAction: Dialog(editor).open\n      });\n      editor.ui.registry.addContextMenu('image', {\n        update: function (element) {\n          return isFigure(element) || isImage(element) && !isPlaceholderImage(element) ? ['image'] : [];\n        }\n      });\n    };\n\n    function Plugin () {\n      global$6.add('image', function (editor) {\n        setup(editor);\n        register(editor);\n        register$1(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}