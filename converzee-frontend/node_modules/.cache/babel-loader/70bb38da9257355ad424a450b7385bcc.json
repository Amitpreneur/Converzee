{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.2 (2021-11-17)\n */\n(function () {\n  'use strict';\n\n  var global$9 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var noop = function () {};\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var identity = function (x) {\n    return x;\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = identity;\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: function () {\n        return none();\n      },\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var nativePush = Array.prototype.push;\n\n  var each$1 = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var get$1 = function (obj, key) {\n    return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var getScripts = function (editor) {\n    return editor.getParam('media_scripts');\n  };\n\n  var getAudioTemplateCallback = function (editor) {\n    return editor.getParam('audio_template_callback');\n  };\n\n  var getVideoTemplateCallback = function (editor) {\n    return editor.getParam('video_template_callback');\n  };\n\n  var hasLiveEmbeds = function (editor) {\n    return editor.getParam('media_live_embeds', true);\n  };\n\n  var shouldFilterHtml = function (editor) {\n    return editor.getParam('media_filter_html', true);\n  };\n\n  var getUrlResolver = function (editor) {\n    return editor.getParam('media_url_resolver');\n  };\n\n  var hasAltSource = function (editor) {\n    return editor.getParam('media_alt_source', true);\n  };\n\n  var hasPoster = function (editor) {\n    return editor.getParam('media_poster', true);\n  };\n\n  var hasDimensions = function (editor) {\n    return editor.getParam('media_dimensions', true);\n  };\n\n  var global$8 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var global$7 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$6 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n  var getVideoScriptMatch = function (prefixes, src) {\n    if (prefixes) {\n      for (var i = 0; i < prefixes.length; i++) {\n        if (src.indexOf(prefixes[i].filter) !== -1) {\n          return prefixes[i];\n        }\n      }\n    }\n  };\n\n  var DOM$1 = global$7.DOM;\n\n  var trimPx = function (value) {\n    return value.replace(/px$/, '');\n  };\n\n  var getEphoxEmbedData = function (attrs) {\n    var style = attrs.map.style;\n    var styles = style ? DOM$1.parseStyle(style) : {};\n    return {\n      type: 'ephox-embed-iri',\n      source: attrs.map['data-ephox-embed-iri'],\n      altsource: '',\n      poster: '',\n      width: get$1(styles, 'max-width').map(trimPx).getOr(''),\n      height: get$1(styles, 'max-height').map(trimPx).getOr('')\n    };\n  };\n\n  var htmlToData = function (prefixes, html) {\n    var isEphoxEmbed = Cell(false);\n    var data = {};\n    global$6({\n      validate: false,\n      allow_conditional_comments: true,\n      start: function (name, attrs) {\n        if (isEphoxEmbed.get()) ;else if (has(attrs.map, 'data-ephox-embed-iri')) {\n          isEphoxEmbed.set(true);\n          data = getEphoxEmbedData(attrs);\n        } else {\n          if (!data.source && name === 'param') {\n            data.source = attrs.map.movie;\n          }\n\n          if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n            if (!data.type) {\n              data.type = name;\n            }\n\n            data = global$8.extend(attrs.map, data);\n          }\n\n          if (name === 'script') {\n            var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n\n            if (!videoScript) {\n              return;\n            }\n\n            data = {\n              type: 'script',\n              source: attrs.map.src,\n              width: String(videoScript.width),\n              height: String(videoScript.height)\n            };\n          }\n\n          if (name === 'source') {\n            if (!data.source) {\n              data.source = attrs.map.src;\n            } else if (!data.altsource) {\n              data.altsource = attrs.map.src;\n            }\n          }\n\n          if (name === 'img' && !data.poster) {\n            data.poster = attrs.map.src;\n          }\n        }\n      }\n    }).parse(html);\n    data.source = data.source || data.src || data.data;\n    data.altsource = data.altsource || '';\n    data.poster = data.poster || '';\n    return data;\n  };\n\n  var guess = function (url) {\n    var mimes = {\n      mp3: 'audio/mpeg',\n      m4a: 'audio/x-m4a',\n      wav: 'audio/wav',\n      mp4: 'video/mp4',\n      webm: 'video/webm',\n      ogg: 'video/ogg',\n      swf: 'application/x-shockwave-flash'\n    };\n    var fileEnd = url.toLowerCase().split('.').pop();\n    var mime = mimes[fileEnd];\n    return mime ? mime : '';\n  };\n\n  var global$5 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n  var global$4 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n  var DOM = global$7.DOM;\n\n  var addPx = function (value) {\n    return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n  };\n\n  var setAttributes = function (attrs, updatedAttrs) {\n    each(updatedAttrs, function (val, name) {\n      var value = '' + val;\n\n      if (attrs.map[name]) {\n        var i = attrs.length;\n\n        while (i--) {\n          var attr = attrs[i];\n\n          if (attr.name === name) {\n            if (value) {\n              attrs.map[name] = value;\n              attr.value = value;\n            } else {\n              delete attrs.map[name];\n              attrs.splice(i, 1);\n            }\n          }\n        }\n      } else if (value) {\n        attrs.push({\n          name: name,\n          value: value\n        });\n        attrs.map[name] = value;\n      }\n    });\n  };\n\n  var updateEphoxEmbed = function (data, attrs) {\n    var style = attrs.map.style;\n    var styleMap = style ? DOM.parseStyle(style) : {};\n    styleMap['max-width'] = addPx(data.width);\n    styleMap['max-height'] = addPx(data.height);\n    setAttributes(attrs, {\n      style: DOM.serializeStyle(styleMap)\n    });\n  };\n\n  var sources = ['source', 'altsource'];\n\n  var updateHtml = function (html, data, updateAll) {\n    var writer = global$4();\n    var isEphoxEmbed = Cell(false);\n    var sourceCount = 0;\n    var hasImage;\n    global$6({\n      validate: false,\n      allow_conditional_comments: true,\n      comment: function (text) {\n        writer.comment(text);\n      },\n      cdata: function (text) {\n        writer.cdata(text);\n      },\n      text: function (text, raw) {\n        writer.text(text, raw);\n      },\n      start: function (name, attrs, empty) {\n        if (isEphoxEmbed.get()) ;else if (has(attrs.map, 'data-ephox-embed-iri')) {\n          isEphoxEmbed.set(true);\n          updateEphoxEmbed(data, attrs);\n        } else {\n          switch (name) {\n            case 'video':\n            case 'object':\n            case 'embed':\n            case 'img':\n            case 'iframe':\n              if (data.height !== undefined && data.width !== undefined) {\n                setAttributes(attrs, {\n                  width: data.width,\n                  height: data.height\n                });\n              }\n\n              break;\n          }\n\n          if (updateAll) {\n            switch (name) {\n              case 'video':\n                setAttributes(attrs, {\n                  poster: data.poster,\n                  src: ''\n                });\n\n                if (data.altsource) {\n                  setAttributes(attrs, {\n                    src: ''\n                  });\n                }\n\n                break;\n\n              case 'iframe':\n                setAttributes(attrs, {\n                  src: data.source\n                });\n                break;\n\n              case 'source':\n                if (sourceCount < 2) {\n                  setAttributes(attrs, {\n                    src: data[sources[sourceCount]],\n                    type: data[sources[sourceCount] + 'mime']\n                  });\n\n                  if (!data[sources[sourceCount]]) {\n                    return;\n                  }\n                }\n\n                sourceCount++;\n                break;\n\n              case 'img':\n                if (!data.poster) {\n                  return;\n                }\n\n                hasImage = true;\n                break;\n            }\n          }\n        }\n        writer.start(name, attrs, empty);\n      },\n      end: function (name) {\n        if (!isEphoxEmbed.get()) {\n          if (name === 'video' && updateAll) {\n            for (var index = 0; index < 2; index++) {\n              if (data[sources[index]]) {\n                var attrs = [];\n                attrs.map = {};\n\n                if (sourceCount <= index) {\n                  setAttributes(attrs, {\n                    src: data[sources[index]],\n                    type: data[sources[index] + 'mime']\n                  });\n                  writer.start('source', attrs, true);\n                }\n              }\n            }\n          }\n\n          if (data.poster && name === 'object' && updateAll && !hasImage) {\n            var imgAttrs = [];\n            imgAttrs.map = {};\n            setAttributes(imgAttrs, {\n              src: data.poster,\n              width: data.width,\n              height: data.height\n            });\n            writer.start('img', imgAttrs, true);\n          }\n        }\n\n        writer.end(name);\n      }\n    }, global$5({})).parse(html);\n    return writer.getContent();\n  };\n\n  var urlPatterns = [{\n    regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n    type: 'iframe',\n    w: 560,\n    h: 314,\n    url: 'www.youtube.com/embed/$1',\n    allowFullscreen: true\n  }, {\n    regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n    type: 'iframe',\n    w: 560,\n    h: 314,\n    url: 'www.youtube.com/embed/$2?$4',\n    allowFullscreen: true\n  }, {\n    regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n    type: 'iframe',\n    w: 560,\n    h: 314,\n    url: 'www.youtube.com/embed/$1',\n    allowFullscreen: true\n  }, {\n    regex: /vimeo\\.com\\/([0-9]+)/,\n    type: 'iframe',\n    w: 425,\n    h: 350,\n    url: 'player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n    allowFullscreen: true\n  }, {\n    regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n    type: 'iframe',\n    w: 425,\n    h: 350,\n    url: 'player.vimeo.com/video/$2?title=0&amp;byline=0',\n    allowFullscreen: true\n  }, {\n    regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n    type: 'iframe',\n    w: 425,\n    h: 350,\n    url: 'maps.google.com/maps/ms?msid=$2&output=embed\"',\n    allowFullscreen: false\n  }, {\n    regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n    type: 'iframe',\n    w: 480,\n    h: 270,\n    url: 'www.dailymotion.com/embed/video/$1',\n    allowFullscreen: true\n  }, {\n    regex: /dai\\.ly\\/([^_]+)/,\n    type: 'iframe',\n    w: 480,\n    h: 270,\n    url: 'www.dailymotion.com/embed/video/$1',\n    allowFullscreen: true\n  }];\n\n  var getProtocol = function (url) {\n    var protocolMatches = url.match(/^(https?:\\/\\/|www\\.)(.+)$/i);\n\n    if (protocolMatches && protocolMatches.length > 1) {\n      return protocolMatches[1] === 'www.' ? 'https://' : protocolMatches[1];\n    } else {\n      return 'https://';\n    }\n  };\n\n  var getUrl = function (pattern, url) {\n    var protocol = getProtocol(url);\n    var match = pattern.regex.exec(url);\n    var newUrl = protocol + pattern.url;\n\n    var _loop_1 = function (i) {\n      newUrl = newUrl.replace('$' + i, function () {\n        return match[i] ? match[i] : '';\n      });\n    };\n\n    for (var i = 0; i < match.length; i++) {\n      _loop_1(i);\n    }\n\n    return newUrl.replace(/\\?$/, '');\n  };\n\n  var matchPattern = function (url) {\n    var patterns = urlPatterns.filter(function (pattern) {\n      return pattern.regex.test(url);\n    });\n\n    if (patterns.length > 0) {\n      return global$8.extend({}, patterns[0], {\n        url: getUrl(patterns[0], url)\n      });\n    } else {\n      return null;\n    }\n  };\n\n  var getIframeHtml = function (data) {\n    var allowFullscreen = data.allowfullscreen ? ' allowFullscreen=\"1\"' : '';\n    return '<iframe src=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n  };\n\n  var getFlashHtml = function (data) {\n    var html = '<object data=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n\n    if (data.poster) {\n      html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n    }\n\n    html += '</object>';\n    return html;\n  };\n\n  var getAudioHtml = function (data, audioTemplateCallback) {\n    if (audioTemplateCallback) {\n      return audioTemplateCallback(data);\n    } else {\n      return '<audio controls=\"controls\" src=\"' + data.source + '\">' + (data.altsource ? '\\n<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</audio>';\n    }\n  };\n\n  var getVideoHtml = function (data, videoTemplateCallback) {\n    if (videoTemplateCallback) {\n      return videoTemplateCallback(data);\n    } else {\n      return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source + '\"' + (data.sourcemime ? ' type=\"' + data.sourcemime + '\"' : '') + ' />\\n' + (data.altsource ? '<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</video>';\n    }\n  };\n\n  var getScriptHtml = function (data) {\n    return '<script src=\"' + data.source + '\"></script>';\n  };\n\n  var dataToHtml = function (editor, dataIn) {\n    var data = global$8.extend({}, dataIn);\n\n    if (!data.source) {\n      global$8.extend(data, htmlToData(getScripts(editor), data.embed));\n\n      if (!data.source) {\n        return '';\n      }\n    }\n\n    if (!data.altsource) {\n      data.altsource = '';\n    }\n\n    if (!data.poster) {\n      data.poster = '';\n    }\n\n    data.source = editor.convertURL(data.source, 'source');\n    data.altsource = editor.convertURL(data.altsource, 'source');\n    data.sourcemime = guess(data.source);\n    data.altsourcemime = guess(data.altsource);\n    data.poster = editor.convertURL(data.poster, 'poster');\n    var pattern = matchPattern(data.source);\n\n    if (pattern) {\n      data.source = pattern.url;\n      data.type = pattern.type;\n      data.allowfullscreen = pattern.allowFullscreen;\n      data.width = data.width || String(pattern.w);\n      data.height = data.height || String(pattern.h);\n    }\n\n    if (data.embed) {\n      return updateHtml(data.embed, data, true);\n    } else {\n      var videoScript = getVideoScriptMatch(getScripts(editor), data.source);\n\n      if (videoScript) {\n        data.type = 'script';\n        data.width = String(videoScript.width);\n        data.height = String(videoScript.height);\n      }\n\n      var audioTemplateCallback = getAudioTemplateCallback(editor);\n      var videoTemplateCallback = getVideoTemplateCallback(editor);\n      data.width = data.width || '300';\n      data.height = data.height || '150';\n      global$8.each(data, function (value, key) {\n        data[key] = editor.dom.encode('' + value);\n      });\n\n      if (data.type === 'iframe') {\n        return getIframeHtml(data);\n      } else if (data.sourcemime === 'application/x-shockwave-flash') {\n        return getFlashHtml(data);\n      } else if (data.sourcemime.indexOf('audio') !== -1) {\n        return getAudioHtml(data, audioTemplateCallback);\n      } else if (data.type === 'script') {\n        return getScriptHtml(data);\n      } else {\n        return getVideoHtml(data, videoTemplateCallback);\n      }\n    }\n  };\n\n  var isMediaElement = function (element) {\n    return element.hasAttribute('data-mce-object') || element.hasAttribute('data-ephox-embed-iri');\n  };\n\n  var setup$2 = function (editor) {\n    editor.on('click keyup touchend', function () {\n      var selectedNode = editor.selection.getNode();\n\n      if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n        if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n          selectedNode.setAttribute('data-mce-selected', '2');\n        }\n      }\n    });\n    editor.on('ObjectSelected', function (e) {\n      var objectType = e.target.getAttribute('data-mce-object');\n\n      if (objectType === 'script') {\n        e.preventDefault();\n      }\n    });\n    editor.on('ObjectResized', function (e) {\n      var target = e.target;\n\n      if (target.getAttribute('data-mce-object')) {\n        var html = target.getAttribute('data-mce-html');\n\n        if (html) {\n          html = unescape(html);\n          target.setAttribute('data-mce-html', escape(updateHtml(html, {\n            width: String(e.width),\n            height: String(e.height)\n          })));\n        }\n      }\n    });\n  };\n\n  var global$3 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n  var cache = {};\n\n  var embedPromise = function (data, dataToHtml, handler) {\n    return new global$3(function (res, rej) {\n      var wrappedResolve = function (response) {\n        if (response.html) {\n          cache[data.source] = response;\n        }\n\n        return res({\n          url: data.source,\n          html: response.html ? response.html : dataToHtml(data)\n        });\n      };\n\n      if (cache[data.source]) {\n        wrappedResolve(cache[data.source]);\n      } else {\n        handler({\n          url: data.source\n        }, wrappedResolve, rej);\n      }\n    });\n  };\n\n  var defaultPromise = function (data, dataToHtml) {\n    return global$3.resolve({\n      html: dataToHtml(data),\n      url: data.source\n    });\n  };\n\n  var loadedData = function (editor) {\n    return function (data) {\n      return dataToHtml(editor, data);\n    };\n  };\n\n  var getEmbedHtml = function (editor, data) {\n    var embedHandler = getUrlResolver(editor);\n    return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n  };\n\n  var isCached = function (url) {\n    return has(cache, url);\n  };\n\n  var extractMeta = function (sourceInput, data) {\n    return get$1(data, sourceInput).bind(function (mainData) {\n      return get$1(mainData, 'meta');\n    });\n  };\n\n  var getValue = function (data, metaData, sourceInput) {\n    return function (prop) {\n      var _a;\n\n      var getFromData = function () {\n        return get$1(data, prop);\n      };\n\n      var getFromMetaData = function () {\n        return get$1(metaData, prop);\n      };\n\n      var getNonEmptyValue = function (c) {\n        return get$1(c, 'value').bind(function (v) {\n          return v.length > 0 ? Optional.some(v) : Optional.none();\n        });\n      };\n\n      var getFromValueFirst = function () {\n        return getFromData().bind(function (child) {\n          return isObject(child) ? getNonEmptyValue(child).orThunk(getFromMetaData) : getFromMetaData().orThunk(function () {\n            return Optional.from(child);\n          });\n        });\n      };\n\n      var getFromMetaFirst = function () {\n        return getFromMetaData().orThunk(function () {\n          return getFromData().bind(function (child) {\n            return isObject(child) ? getNonEmptyValue(child) : Optional.from(child);\n          });\n        });\n      };\n\n      return _a = {}, _a[prop] = (prop === sourceInput ? getFromValueFirst() : getFromMetaFirst()).getOr(''), _a;\n    };\n  };\n\n  var getDimensions = function (data, metaData) {\n    var dimensions = {};\n    get$1(data, 'dimensions').each(function (dims) {\n      each$1(['width', 'height'], function (prop) {\n        get$1(metaData, prop).orThunk(function () {\n          return get$1(dims, prop);\n        }).each(function (value) {\n          return dimensions[prop] = value;\n        });\n      });\n    });\n    return dimensions;\n  };\n\n  var unwrap = function (data, sourceInput) {\n    var metaData = sourceInput ? extractMeta(sourceInput, data).getOr({}) : {};\n    var get = getValue(data, metaData, sourceInput);\n    return __assign(__assign(__assign(__assign(__assign({}, get('source')), get('altsource')), get('poster')), get('embed')), getDimensions(data, metaData));\n  };\n\n  var wrap = function (data) {\n    var wrapped = __assign(__assign({}, data), {\n      source: {\n        value: get$1(data, 'source').getOr('')\n      },\n      altsource: {\n        value: get$1(data, 'altsource').getOr('')\n      },\n      poster: {\n        value: get$1(data, 'poster').getOr('')\n      }\n    });\n\n    each$1(['width', 'height'], function (prop) {\n      get$1(data, prop).each(function (value) {\n        var dimensions = wrapped.dimensions || {};\n        dimensions[prop] = value;\n        wrapped.dimensions = dimensions;\n      });\n    });\n    return wrapped;\n  };\n\n  var handleError = function (editor) {\n    return function (error) {\n      var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n      editor.notificationManager.open({\n        type: 'error',\n        text: errorMessage\n      });\n    };\n  };\n\n  var snippetToData = function (editor, embedSnippet) {\n    return htmlToData(getScripts(editor), embedSnippet);\n  };\n\n  var getEditorData = function (editor) {\n    var element = editor.selection.getNode();\n    var snippet = isMediaElement(element) ? editor.serializer.serialize(element, {\n      selection: true\n    }) : '';\n    return __assign({\n      embed: snippet\n    }, htmlToData(getScripts(editor), snippet));\n  };\n\n  var addEmbedHtml = function (api, editor) {\n    return function (response) {\n      if (isString(response.url) && response.url.trim().length > 0) {\n        var html = response.html;\n        var snippetData = snippetToData(editor, html);\n\n        var nuData = __assign(__assign({}, snippetData), {\n          source: response.url,\n          embed: html\n        });\n\n        api.setData(wrap(nuData));\n      }\n    };\n  };\n\n  var selectPlaceholder = function (editor, beforeObjects) {\n    var afterObjects = editor.dom.select('*[data-mce-object]');\n\n    for (var i = 0; i < beforeObjects.length; i++) {\n      for (var y = afterObjects.length - 1; y >= 0; y--) {\n        if (beforeObjects[i] === afterObjects[y]) {\n          afterObjects.splice(y, 1);\n        }\n      }\n    }\n\n    editor.selection.select(afterObjects[0]);\n  };\n\n  var handleInsert = function (editor, html) {\n    var beforeObjects = editor.dom.select('*[data-mce-object]');\n    editor.insertContent(html);\n    selectPlaceholder(editor, beforeObjects);\n    editor.nodeChanged();\n  };\n\n  var submitForm = function (prevData, newData, editor) {\n    newData.embed = updateHtml(newData.embed, newData);\n\n    if (newData.embed && (prevData.source === newData.source || isCached(newData.source))) {\n      handleInsert(editor, newData.embed);\n    } else {\n      getEmbedHtml(editor, newData).then(function (response) {\n        handleInsert(editor, response.html);\n      }).catch(handleError(editor));\n    }\n  };\n\n  var showDialog = function (editor) {\n    var editorData = getEditorData(editor);\n    var currentData = Cell(editorData);\n    var initialData = wrap(editorData);\n\n    var handleSource = function (prevData, api) {\n      var serviceData = unwrap(api.getData(), 'source');\n\n      if (prevData.source !== serviceData.source) {\n        addEmbedHtml(win, editor)({\n          url: serviceData.source,\n          html: ''\n        });\n        getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n      }\n    };\n\n    var handleEmbed = function (api) {\n      var data = unwrap(api.getData());\n      var dataFromEmbed = snippetToData(editor, data.embed);\n      api.setData(wrap(dataFromEmbed));\n    };\n\n    var handleUpdate = function (api, sourceInput) {\n      var data = unwrap(api.getData(), sourceInput);\n      var embed = dataToHtml(editor, data);\n      api.setData(wrap(__assign(__assign({}, data), {\n        embed: embed\n      })));\n    };\n\n    var mediaInput = [{\n      name: 'source',\n      type: 'urlinput',\n      filetype: 'media',\n      label: 'Source'\n    }];\n    var sizeInput = !hasDimensions(editor) ? [] : [{\n      type: 'sizeinput',\n      name: 'dimensions',\n      label: 'Constrain proportions',\n      constrain: true\n    }];\n    var generalTab = {\n      title: 'General',\n      name: 'general',\n      items: flatten([mediaInput, sizeInput])\n    };\n    var embedTextarea = {\n      type: 'textarea',\n      name: 'embed',\n      label: 'Paste your embed code below:'\n    };\n    var embedTab = {\n      title: 'Embed',\n      items: [embedTextarea]\n    };\n    var advancedFormItems = [];\n\n    if (hasAltSource(editor)) {\n      advancedFormItems.push({\n        name: 'altsource',\n        type: 'urlinput',\n        filetype: 'media',\n        label: 'Alternative source URL'\n      });\n    }\n\n    if (hasPoster(editor)) {\n      advancedFormItems.push({\n        name: 'poster',\n        type: 'urlinput',\n        filetype: 'image',\n        label: 'Media poster (Image URL)'\n      });\n    }\n\n    var advancedTab = {\n      title: 'Advanced',\n      name: 'advanced',\n      items: advancedFormItems\n    };\n    var tabs = [generalTab, embedTab];\n\n    if (advancedFormItems.length > 0) {\n      tabs.push(advancedTab);\n    }\n\n    var body = {\n      type: 'tabpanel',\n      tabs: tabs\n    };\n    var win = editor.windowManager.open({\n      title: 'Insert/Edit Media',\n      size: 'normal',\n      body: body,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      onSubmit: function (api) {\n        var serviceData = unwrap(api.getData());\n        submitForm(currentData.get(), serviceData, editor);\n        api.close();\n      },\n      onChange: function (api, detail) {\n        switch (detail.name) {\n          case 'source':\n            handleSource(currentData.get(), api);\n            break;\n\n          case 'embed':\n            handleEmbed(api);\n            break;\n\n          case 'dimensions':\n          case 'altsource':\n          case 'poster':\n            handleUpdate(api, detail.name);\n            break;\n        }\n\n        currentData.set(unwrap(api.getData()));\n      },\n      initialData: initialData\n    });\n  };\n\n  var get = function (editor) {\n    var showDialog$1 = function () {\n      showDialog(editor);\n    };\n\n    return {\n      showDialog: showDialog$1\n    };\n  };\n\n  var register$1 = function (editor) {\n    var showDialog$1 = function () {\n      showDialog(editor);\n    };\n\n    editor.addCommand('mceMedia', showDialog$1);\n  };\n\n  var global$2 = tinymce.util.Tools.resolve('tinymce.html.Node');\n  var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n  var global = tinymce.util.Tools.resolve('tinymce.html.DomParser');\n\n  var sanitize = function (editor, html) {\n    if (shouldFilterHtml(editor) === false) {\n      return html;\n    }\n\n    var writer = global$4();\n    var blocked;\n    global$6({\n      validate: false,\n      allow_conditional_comments: false,\n      comment: function (text) {\n        if (!blocked) {\n          writer.comment(text);\n        }\n      },\n      cdata: function (text) {\n        if (!blocked) {\n          writer.cdata(text);\n        }\n      },\n      text: function (text, raw) {\n        if (!blocked) {\n          writer.text(text, raw);\n        }\n      },\n      start: function (name, attrs, empty) {\n        blocked = true;\n\n        if (name === 'script' || name === 'noscript' || name === 'svg') {\n          return;\n        }\n\n        for (var i = attrs.length - 1; i >= 0; i--) {\n          var attrName = attrs[i].name;\n\n          if (attrName.indexOf('on') === 0) {\n            delete attrs.map[attrName];\n            attrs.splice(i, 1);\n          }\n\n          if (attrName === 'style') {\n            attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n          }\n        }\n\n        writer.start(name, attrs, empty);\n        blocked = false;\n      },\n      end: function (name) {\n        if (blocked) {\n          return;\n        }\n\n        writer.end(name);\n      }\n    }, global$5({})).parse(html);\n    return writer.getContent();\n  };\n\n  var isLiveEmbedNode = function (node) {\n    var name = node.name;\n    return name === 'iframe' || name === 'video' || name === 'audio';\n  };\n\n  var getDimension = function (node, styles, dimension, defaultValue) {\n    if (defaultValue === void 0) {\n      defaultValue = null;\n    }\n\n    var value = node.attr(dimension);\n\n    if (isNonNullable(value)) {\n      return value;\n    } else if (!has(styles, dimension)) {\n      return defaultValue;\n    } else {\n      return null;\n    }\n  };\n\n  var setDimensions = function (node, previewNode, styles) {\n    var useDefaults = previewNode.name === 'img' || node.name === 'video';\n    var defaultWidth = useDefaults ? '300' : null;\n    var fallbackHeight = node.name === 'audio' ? '30' : '150';\n    var defaultHeight = useDefaults ? fallbackHeight : null;\n    previewNode.attr({\n      width: getDimension(node, styles, 'width', defaultWidth),\n      height: getDimension(node, styles, 'height', defaultHeight)\n    });\n  };\n\n  var appendNodeContent = function (editor, nodeName, previewNode, html) {\n    var newNode = global({\n      forced_root_block: false,\n      validate: false\n    }, editor.schema).parse(html, {\n      context: nodeName\n    });\n\n    while (newNode.firstChild) {\n      previewNode.append(newNode.firstChild);\n    }\n  };\n\n  var createPlaceholderNode = function (editor, node) {\n    var name = node.name;\n    var placeHolder = new global$2('img', 1);\n    placeHolder.shortEnded = true;\n    retainAttributesAndInnerHtml(editor, node, placeHolder);\n    setDimensions(node, placeHolder, {});\n    placeHolder.attr({\n      'style': node.attr('style'),\n      'src': global$1.transparentSrc,\n      'data-mce-object': name,\n      'class': 'mce-object mce-object-' + name\n    });\n    return placeHolder;\n  };\n\n  var createPreviewNode = function (editor, node) {\n    var name = node.name;\n    var previewWrapper = new global$2('span', 1);\n    previewWrapper.attr({\n      'contentEditable': 'false',\n      'style': node.attr('style'),\n      'data-mce-object': name,\n      'class': 'mce-preview-object mce-object-' + name\n    });\n    retainAttributesAndInnerHtml(editor, node, previewWrapper);\n    var styles = editor.dom.parseStyle(node.attr('style'));\n    var previewNode = new global$2(name, 1);\n    setDimensions(node, previewNode, styles);\n    previewNode.attr({\n      src: node.attr('src'),\n      style: node.attr('style'),\n      class: node.attr('class')\n    });\n\n    if (name === 'iframe') {\n      previewNode.attr({\n        allowfullscreen: node.attr('allowfullscreen'),\n        frameborder: '0'\n      });\n    } else {\n      var attrs = ['controls', 'crossorigin', 'currentTime', 'loop', 'muted', 'poster', 'preload'];\n      each$1(attrs, function (attrName) {\n        previewNode.attr(attrName, node.attr(attrName));\n      });\n      var sanitizedHtml = previewWrapper.attr('data-mce-html');\n\n      if (isNonNullable(sanitizedHtml)) {\n        appendNodeContent(editor, name, previewNode, unescape(sanitizedHtml));\n      }\n    }\n\n    var shimNode = new global$2('span', 1);\n    shimNode.attr('class', 'mce-shim');\n    previewWrapper.append(previewNode);\n    previewWrapper.append(shimNode);\n    return previewWrapper;\n  };\n\n  var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n    var attribs = sourceNode.attributes;\n    var ai = attribs.length;\n\n    while (ai--) {\n      var attrName = attribs[ai].name;\n      var attrValue = attribs[ai].value;\n\n      if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n        if (attrName === 'data' || attrName === 'src') {\n          attrValue = editor.convertURL(attrValue, attrName);\n        }\n\n        targetNode.attr('data-mce-p-' + attrName, attrValue);\n      }\n    }\n\n    var innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n\n    if (innerHtml) {\n      targetNode.attr('data-mce-html', escape(sanitize(editor, innerHtml)));\n      targetNode.firstChild = null;\n    }\n  };\n\n  var isPageEmbedWrapper = function (node) {\n    var nodeClass = node.attr('class');\n    return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n  };\n\n  var isWithinEmbedWrapper = function (node) {\n    while (node = node.parent) {\n      if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var placeHolderConverter = function (editor) {\n    return function (nodes) {\n      var i = nodes.length;\n      var node;\n      var videoScript;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (!node.parent) {\n          continue;\n        }\n\n        if (node.parent.attr('data-mce-object')) {\n          continue;\n        }\n\n        if (node.name === 'script') {\n          videoScript = getVideoScriptMatch(getScripts(editor), node.attr('src'));\n\n          if (!videoScript) {\n            continue;\n          }\n        }\n\n        if (videoScript) {\n          if (videoScript.width) {\n            node.attr('width', videoScript.width.toString());\n          }\n\n          if (videoScript.height) {\n            node.attr('height', videoScript.height.toString());\n          }\n        }\n\n        if (isLiveEmbedNode(node) && hasLiveEmbeds(editor) && global$1.ceFalse) {\n          if (!isWithinEmbedWrapper(node)) {\n            node.replace(createPreviewNode(editor, node));\n          }\n        } else {\n          if (!isWithinEmbedWrapper(node)) {\n            node.replace(createPlaceholderNode(editor, node));\n          }\n        }\n      }\n    };\n  };\n\n  var setup$1 = function (editor) {\n    editor.on('preInit', function () {\n      var specialElements = editor.schema.getSpecialElements();\n      global$8.each('video audio iframe object'.split(' '), function (name) {\n        specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n      });\n      var boolAttrs = editor.schema.getBoolAttrs();\n      global$8.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n        boolAttrs[name] = {};\n      });\n      editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', placeHolderConverter(editor));\n      editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n        var i = nodes.length;\n        var node;\n        var realElm;\n        var ai;\n        var attribs;\n        var innerHtml;\n        var innerNode;\n        var realElmName;\n        var className;\n\n        while (i--) {\n          node = nodes[i];\n\n          if (!node.parent) {\n            continue;\n          }\n\n          realElmName = node.attr(name);\n          realElm = new global$2(realElmName, 1);\n\n          if (realElmName !== 'audio' && realElmName !== 'script') {\n            className = node.attr('class');\n\n            if (className && className.indexOf('mce-preview-object') !== -1) {\n              realElm.attr({\n                width: node.firstChild.attr('width'),\n                height: node.firstChild.attr('height')\n              });\n            } else {\n              realElm.attr({\n                width: node.attr('width'),\n                height: node.attr('height')\n              });\n            }\n          }\n\n          realElm.attr({\n            style: node.attr('style')\n          });\n          attribs = node.attributes;\n          ai = attribs.length;\n\n          while (ai--) {\n            var attrName = attribs[ai].name;\n\n            if (attrName.indexOf('data-mce-p-') === 0) {\n              realElm.attr(attrName.substr(11), attribs[ai].value);\n            }\n          }\n\n          if (realElmName === 'script') {\n            realElm.attr('type', 'text/javascript');\n          }\n\n          innerHtml = node.attr('data-mce-html');\n\n          if (innerHtml) {\n            innerNode = new global$2('#text', 3);\n            innerNode.raw = true;\n            innerNode.value = sanitize(editor, unescape(innerHtml));\n            realElm.append(innerNode);\n          }\n\n          node.replace(realElm);\n        }\n      });\n    });\n    editor.on('SetContent', function () {\n      editor.$('span.mce-preview-object').each(function (index, elm) {\n        var $elm = editor.$(elm);\n\n        if ($elm.find('span.mce-shim').length === 0) {\n          $elm.append('<span class=\"mce-shim\"></span>');\n        }\n      });\n    });\n  };\n\n  var setup = function (editor) {\n    editor.on('ResolveName', function (e) {\n      var name;\n\n      if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n        e.name = name;\n      }\n    });\n  };\n\n  var register = function (editor) {\n    var onAction = function () {\n      return editor.execCommand('mceMedia');\n    };\n\n    editor.ui.registry.addToggleButton('media', {\n      tooltip: 'Insert/edit media',\n      icon: 'embed',\n      onAction: onAction,\n      onSetup: function (buttonApi) {\n        var selection = editor.selection;\n        buttonApi.setActive(isMediaElement(selection.getNode()));\n        return selection.selectorChangedWithUnbind('img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]', buttonApi.setActive).unbind;\n      }\n    });\n    editor.ui.registry.addMenuItem('media', {\n      icon: 'embed',\n      text: 'Media...',\n      onAction: onAction\n    });\n  };\n\n  function Plugin() {\n    global$9.add('media', function (editor) {\n      register$1(editor);\n      register(editor);\n      setup(editor);\n      setup$1(editor);\n      setup$2(editor);\n      return get(editor);\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/opt/bitnami/apache/htdocs/converzee-frontend/node_modules/tinymce/plugins/media/plugin.js"],"names":["global$9","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","typeOf","x","Array","isPrototypeOf","constructor","name","String","isType","type","value","isString","isObject","isArray","isNullable","a","undefined","isNonNullable","noop","constant","identity","never","always","none","NONE","thunk","id","me","fold","_s","isSome","isNone","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","toArray","toString","some","constant_a","self","f","from","Optional","nativePush","push","each$1","xs","len","flatten","r","Cell","initial","get","set","v","keys","obj","props","k","get$1","key","has","getScripts","editor","getParam","getAudioTemplateCallback","getVideoTemplateCallback","hasLiveEmbeds","shouldFilterHtml","getUrlResolver","hasAltSource","hasPoster","hasDimensions","global$8","global$7","global$6","getVideoScriptMatch","prefixes","src","indexOf","DOM$1","DOM","trimPx","replace","getEphoxEmbedData","attrs","style","styles","parseStyle","source","altsource","poster","width","height","htmlToData","html","isEphoxEmbed","data","validate","allow_conditional_comments","start","movie","extend","videoScript","parse","guess","url","mimes","mp3","m4a","wav","mp4","webm","ogg","swf","fileEnd","toLowerCase","split","pop","mime","global$5","global$4","addPx","test","setAttributes","updatedAttrs","val","attr","splice","updateEphoxEmbed","styleMap","serializeStyle","sources","updateHtml","updateAll","writer","sourceCount","hasImage","comment","text","cdata","raw","empty","end","index","imgAttrs","getContent","urlPatterns","regex","w","h","allowFullscreen","getProtocol","protocolMatches","match","getUrl","pattern","protocol","exec","newUrl","_loop_1","matchPattern","patterns","getIframeHtml","allowfullscreen","getFlashHtml","getAudioHtml","audioTemplateCallback","altsourcemime","getVideoHtml","videoTemplateCallback","sourcemime","getScriptHtml","dataToHtml","dataIn","embed","convertURL","dom","encode","isMediaElement","element","hasAttribute","setup$2","on","selectedNode","selection","getNode","hasClass","getAttrib","setAttribute","e","objectType","target","getAttribute","preventDefault","unescape","escape","global$3","cache","embedPromise","handler","res","rej","wrappedResolve","response","defaultPromise","loadedData","getEmbedHtml","embedHandler","isCached","extractMeta","sourceInput","mainData","getValue","metaData","prop","_a","getFromData","getFromMetaData","getNonEmptyValue","c","getFromValueFirst","child","getFromMetaFirst","getDimensions","dimensions","dims","unwrap","wrap","wrapped","handleError","error","errorMessage","notificationManager","open","snippetToData","embedSnippet","getEditorData","snippet","serializer","serialize","addEmbedHtml","api","trim","snippetData","nuData","setData","selectPlaceholder","beforeObjects","afterObjects","select","y","handleInsert","insertContent","nodeChanged","submitForm","prevData","newData","then","catch","showDialog","editorData","currentData","initialData","handleSource","serviceData","getData","win","handleEmbed","dataFromEmbed","handleUpdate","mediaInput","filetype","label","sizeInput","constrain","generalTab","title","items","embedTextarea","embedTab","advancedFormItems","advancedTab","tabs","body","windowManager","size","buttons","primary","onSubmit","close","onChange","detail","showDialog$1","register$1","addCommand","global$2","global$1","global","sanitize","blocked","attrName","isLiveEmbedNode","node","getDimension","dimension","defaultValue","setDimensions","previewNode","useDefaults","defaultWidth","fallbackHeight","defaultHeight","appendNodeContent","nodeName","newNode","forced_root_block","schema","context","firstChild","append","createPlaceholderNode","placeHolder","shortEnded","retainAttributesAndInnerHtml","transparentSrc","createPreviewNode","previewWrapper","class","frameborder","sanitizedHtml","shimNode","sourceNode","targetNode","attribs","attributes","ai","attrValue","innerHtml","isPageEmbedWrapper","nodeClass","isWithinEmbedWrapper","parent","placeHolderConverter","nodes","ceFalse","setup$1","specialElements","getSpecialElements","RegExp","boolAttrs","getBoolAttrs","parser","addNodeFilter","addAttributeFilter","realElm","innerNode","realElmName","className","substr","$","elm","$elm","find","setup","nodeType","register","onAction","execCommand","ui","registry","addToggleButton","tooltip","icon","onSetup","buttonApi","setActive","selectorChangedWithUnbind","unbind","addMenuItem","Plugin","add"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.2 (2021-11-17)\n */\n(function () {\n    'use strict';\n\n    var global$9 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = identity;\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: function () {\n          return none();\n        },\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var nativePush = Array.prototype.push;\n    var each$1 = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var get$1 = function (obj, key) {\n      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n\n    var getScripts = function (editor) {\n      return editor.getParam('media_scripts');\n    };\n    var getAudioTemplateCallback = function (editor) {\n      return editor.getParam('audio_template_callback');\n    };\n    var getVideoTemplateCallback = function (editor) {\n      return editor.getParam('video_template_callback');\n    };\n    var hasLiveEmbeds = function (editor) {\n      return editor.getParam('media_live_embeds', true);\n    };\n    var shouldFilterHtml = function (editor) {\n      return editor.getParam('media_filter_html', true);\n    };\n    var getUrlResolver = function (editor) {\n      return editor.getParam('media_url_resolver');\n    };\n    var hasAltSource = function (editor) {\n      return editor.getParam('media_alt_source', true);\n    };\n    var hasPoster = function (editor) {\n      return editor.getParam('media_poster', true);\n    };\n    var hasDimensions = function (editor) {\n      return editor.getParam('media_dimensions', true);\n    };\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n    var getVideoScriptMatch = function (prefixes, src) {\n      if (prefixes) {\n        for (var i = 0; i < prefixes.length; i++) {\n          if (src.indexOf(prefixes[i].filter) !== -1) {\n            return prefixes[i];\n          }\n        }\n      }\n    };\n\n    var DOM$1 = global$7.DOM;\n    var trimPx = function (value) {\n      return value.replace(/px$/, '');\n    };\n    var getEphoxEmbedData = function (attrs) {\n      var style = attrs.map.style;\n      var styles = style ? DOM$1.parseStyle(style) : {};\n      return {\n        type: 'ephox-embed-iri',\n        source: attrs.map['data-ephox-embed-iri'],\n        altsource: '',\n        poster: '',\n        width: get$1(styles, 'max-width').map(trimPx).getOr(''),\n        height: get$1(styles, 'max-height').map(trimPx).getOr('')\n      };\n    };\n    var htmlToData = function (prefixes, html) {\n      var isEphoxEmbed = Cell(false);\n      var data = {};\n      global$6({\n        validate: false,\n        allow_conditional_comments: true,\n        start: function (name, attrs) {\n          if (isEphoxEmbed.get()) ; else if (has(attrs.map, 'data-ephox-embed-iri')) {\n            isEphoxEmbed.set(true);\n            data = getEphoxEmbedData(attrs);\n          } else {\n            if (!data.source && name === 'param') {\n              data.source = attrs.map.movie;\n            }\n            if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n              if (!data.type) {\n                data.type = name;\n              }\n              data = global$8.extend(attrs.map, data);\n            }\n            if (name === 'script') {\n              var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n              if (!videoScript) {\n                return;\n              }\n              data = {\n                type: 'script',\n                source: attrs.map.src,\n                width: String(videoScript.width),\n                height: String(videoScript.height)\n              };\n            }\n            if (name === 'source') {\n              if (!data.source) {\n                data.source = attrs.map.src;\n              } else if (!data.altsource) {\n                data.altsource = attrs.map.src;\n              }\n            }\n            if (name === 'img' && !data.poster) {\n              data.poster = attrs.map.src;\n            }\n          }\n        }\n      }).parse(html);\n      data.source = data.source || data.src || data.data;\n      data.altsource = data.altsource || '';\n      data.poster = data.poster || '';\n      return data;\n    };\n\n    var guess = function (url) {\n      var mimes = {\n        mp3: 'audio/mpeg',\n        m4a: 'audio/x-m4a',\n        wav: 'audio/wav',\n        mp4: 'video/mp4',\n        webm: 'video/webm',\n        ogg: 'video/ogg',\n        swf: 'application/x-shockwave-flash'\n      };\n      var fileEnd = url.toLowerCase().split('.').pop();\n      var mime = mimes[fileEnd];\n      return mime ? mime : '';\n    };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n\n    var DOM = global$7.DOM;\n    var addPx = function (value) {\n      return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n    };\n    var setAttributes = function (attrs, updatedAttrs) {\n      each(updatedAttrs, function (val, name) {\n        var value = '' + val;\n        if (attrs.map[name]) {\n          var i = attrs.length;\n          while (i--) {\n            var attr = attrs[i];\n            if (attr.name === name) {\n              if (value) {\n                attrs.map[name] = value;\n                attr.value = value;\n              } else {\n                delete attrs.map[name];\n                attrs.splice(i, 1);\n              }\n            }\n          }\n        } else if (value) {\n          attrs.push({\n            name: name,\n            value: value\n          });\n          attrs.map[name] = value;\n        }\n      });\n    };\n    var updateEphoxEmbed = function (data, attrs) {\n      var style = attrs.map.style;\n      var styleMap = style ? DOM.parseStyle(style) : {};\n      styleMap['max-width'] = addPx(data.width);\n      styleMap['max-height'] = addPx(data.height);\n      setAttributes(attrs, { style: DOM.serializeStyle(styleMap) });\n    };\n    var sources = [\n      'source',\n      'altsource'\n    ];\n    var updateHtml = function (html, data, updateAll) {\n      var writer = global$4();\n      var isEphoxEmbed = Cell(false);\n      var sourceCount = 0;\n      var hasImage;\n      global$6({\n        validate: false,\n        allow_conditional_comments: true,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          if (isEphoxEmbed.get()) ; else if (has(attrs.map, 'data-ephox-embed-iri')) {\n            isEphoxEmbed.set(true);\n            updateEphoxEmbed(data, attrs);\n          } else {\n            switch (name) {\n            case 'video':\n            case 'object':\n            case 'embed':\n            case 'img':\n            case 'iframe':\n              if (data.height !== undefined && data.width !== undefined) {\n                setAttributes(attrs, {\n                  width: data.width,\n                  height: data.height\n                });\n              }\n              break;\n            }\n            if (updateAll) {\n              switch (name) {\n              case 'video':\n                setAttributes(attrs, {\n                  poster: data.poster,\n                  src: ''\n                });\n                if (data.altsource) {\n                  setAttributes(attrs, { src: '' });\n                }\n                break;\n              case 'iframe':\n                setAttributes(attrs, { src: data.source });\n                break;\n              case 'source':\n                if (sourceCount < 2) {\n                  setAttributes(attrs, {\n                    src: data[sources[sourceCount]],\n                    type: data[sources[sourceCount] + 'mime']\n                  });\n                  if (!data[sources[sourceCount]]) {\n                    return;\n                  }\n                }\n                sourceCount++;\n                break;\n              case 'img':\n                if (!data.poster) {\n                  return;\n                }\n                hasImage = true;\n                break;\n              }\n            }\n          }\n          writer.start(name, attrs, empty);\n        },\n        end: function (name) {\n          if (!isEphoxEmbed.get()) {\n            if (name === 'video' && updateAll) {\n              for (var index = 0; index < 2; index++) {\n                if (data[sources[index]]) {\n                  var attrs = [];\n                  attrs.map = {};\n                  if (sourceCount <= index) {\n                    setAttributes(attrs, {\n                      src: data[sources[index]],\n                      type: data[sources[index] + 'mime']\n                    });\n                    writer.start('source', attrs, true);\n                  }\n                }\n              }\n            }\n            if (data.poster && name === 'object' && updateAll && !hasImage) {\n              var imgAttrs = [];\n              imgAttrs.map = {};\n              setAttributes(imgAttrs, {\n                src: data.poster,\n                width: data.width,\n                height: data.height\n              });\n              writer.start('img', imgAttrs, true);\n            }\n          }\n          writer.end(name);\n        }\n      }, global$5({})).parse(html);\n      return writer.getContent();\n    };\n\n    var urlPatterns = [\n      {\n        regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$2?$4',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'player.vimeo.com/video/$2?title=0&amp;byline=0',\n        allowFullscreen: true\n      },\n      {\n        regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'maps.google.com/maps/ms?msid=$2&output=embed\"',\n        allowFullscreen: false\n      },\n      {\n        regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: 'www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /dai\\.ly\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: 'www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      }\n    ];\n    var getProtocol = function (url) {\n      var protocolMatches = url.match(/^(https?:\\/\\/|www\\.)(.+)$/i);\n      if (protocolMatches && protocolMatches.length > 1) {\n        return protocolMatches[1] === 'www.' ? 'https://' : protocolMatches[1];\n      } else {\n        return 'https://';\n      }\n    };\n    var getUrl = function (pattern, url) {\n      var protocol = getProtocol(url);\n      var match = pattern.regex.exec(url);\n      var newUrl = protocol + pattern.url;\n      var _loop_1 = function (i) {\n        newUrl = newUrl.replace('$' + i, function () {\n          return match[i] ? match[i] : '';\n        });\n      };\n      for (var i = 0; i < match.length; i++) {\n        _loop_1(i);\n      }\n      return newUrl.replace(/\\?$/, '');\n    };\n    var matchPattern = function (url) {\n      var patterns = urlPatterns.filter(function (pattern) {\n        return pattern.regex.test(url);\n      });\n      if (patterns.length > 0) {\n        return global$8.extend({}, patterns[0], { url: getUrl(patterns[0], url) });\n      } else {\n        return null;\n      }\n    };\n\n    var getIframeHtml = function (data) {\n      var allowFullscreen = data.allowfullscreen ? ' allowFullscreen=\"1\"' : '';\n      return '<iframe src=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n    };\n    var getFlashHtml = function (data) {\n      var html = '<object data=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n      if (data.poster) {\n        html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n      }\n      html += '</object>';\n      return html;\n    };\n    var getAudioHtml = function (data, audioTemplateCallback) {\n      if (audioTemplateCallback) {\n        return audioTemplateCallback(data);\n      } else {\n        return '<audio controls=\"controls\" src=\"' + data.source + '\">' + (data.altsource ? '\\n<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</audio>';\n      }\n    };\n    var getVideoHtml = function (data, videoTemplateCallback) {\n      if (videoTemplateCallback) {\n        return videoTemplateCallback(data);\n      } else {\n        return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source + '\"' + (data.sourcemime ? ' type=\"' + data.sourcemime + '\"' : '') + ' />\\n' + (data.altsource ? '<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</video>';\n      }\n    };\n    var getScriptHtml = function (data) {\n      return '<script src=\"' + data.source + '\"></script>';\n    };\n    var dataToHtml = function (editor, dataIn) {\n      var data = global$8.extend({}, dataIn);\n      if (!data.source) {\n        global$8.extend(data, htmlToData(getScripts(editor), data.embed));\n        if (!data.source) {\n          return '';\n        }\n      }\n      if (!data.altsource) {\n        data.altsource = '';\n      }\n      if (!data.poster) {\n        data.poster = '';\n      }\n      data.source = editor.convertURL(data.source, 'source');\n      data.altsource = editor.convertURL(data.altsource, 'source');\n      data.sourcemime = guess(data.source);\n      data.altsourcemime = guess(data.altsource);\n      data.poster = editor.convertURL(data.poster, 'poster');\n      var pattern = matchPattern(data.source);\n      if (pattern) {\n        data.source = pattern.url;\n        data.type = pattern.type;\n        data.allowfullscreen = pattern.allowFullscreen;\n        data.width = data.width || String(pattern.w);\n        data.height = data.height || String(pattern.h);\n      }\n      if (data.embed) {\n        return updateHtml(data.embed, data, true);\n      } else {\n        var videoScript = getVideoScriptMatch(getScripts(editor), data.source);\n        if (videoScript) {\n          data.type = 'script';\n          data.width = String(videoScript.width);\n          data.height = String(videoScript.height);\n        }\n        var audioTemplateCallback = getAudioTemplateCallback(editor);\n        var videoTemplateCallback = getVideoTemplateCallback(editor);\n        data.width = data.width || '300';\n        data.height = data.height || '150';\n        global$8.each(data, function (value, key) {\n          data[key] = editor.dom.encode('' + value);\n        });\n        if (data.type === 'iframe') {\n          return getIframeHtml(data);\n        } else if (data.sourcemime === 'application/x-shockwave-flash') {\n          return getFlashHtml(data);\n        } else if (data.sourcemime.indexOf('audio') !== -1) {\n          return getAudioHtml(data, audioTemplateCallback);\n        } else if (data.type === 'script') {\n          return getScriptHtml(data);\n        } else {\n          return getVideoHtml(data, videoTemplateCallback);\n        }\n      }\n    };\n\n    var isMediaElement = function (element) {\n      return element.hasAttribute('data-mce-object') || element.hasAttribute('data-ephox-embed-iri');\n    };\n    var setup$2 = function (editor) {\n      editor.on('click keyup touchend', function () {\n        var selectedNode = editor.selection.getNode();\n        if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n          if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n            selectedNode.setAttribute('data-mce-selected', '2');\n          }\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        var objectType = e.target.getAttribute('data-mce-object');\n        if (objectType === 'script') {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectResized', function (e) {\n        var target = e.target;\n        if (target.getAttribute('data-mce-object')) {\n          var html = target.getAttribute('data-mce-html');\n          if (html) {\n            html = unescape(html);\n            target.setAttribute('data-mce-html', escape(updateHtml(html, {\n              width: String(e.width),\n              height: String(e.height)\n            })));\n          }\n        }\n      });\n    };\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var cache = {};\n    var embedPromise = function (data, dataToHtml, handler) {\n      return new global$3(function (res, rej) {\n        var wrappedResolve = function (response) {\n          if (response.html) {\n            cache[data.source] = response;\n          }\n          return res({\n            url: data.source,\n            html: response.html ? response.html : dataToHtml(data)\n          });\n        };\n        if (cache[data.source]) {\n          wrappedResolve(cache[data.source]);\n        } else {\n          handler({ url: data.source }, wrappedResolve, rej);\n        }\n      });\n    };\n    var defaultPromise = function (data, dataToHtml) {\n      return global$3.resolve({\n        html: dataToHtml(data),\n        url: data.source\n      });\n    };\n    var loadedData = function (editor) {\n      return function (data) {\n        return dataToHtml(editor, data);\n      };\n    };\n    var getEmbedHtml = function (editor, data) {\n      var embedHandler = getUrlResolver(editor);\n      return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n    };\n    var isCached = function (url) {\n      return has(cache, url);\n    };\n\n    var extractMeta = function (sourceInput, data) {\n      return get$1(data, sourceInput).bind(function (mainData) {\n        return get$1(mainData, 'meta');\n      });\n    };\n    var getValue = function (data, metaData, sourceInput) {\n      return function (prop) {\n        var _a;\n        var getFromData = function () {\n          return get$1(data, prop);\n        };\n        var getFromMetaData = function () {\n          return get$1(metaData, prop);\n        };\n        var getNonEmptyValue = function (c) {\n          return get$1(c, 'value').bind(function (v) {\n            return v.length > 0 ? Optional.some(v) : Optional.none();\n          });\n        };\n        var getFromValueFirst = function () {\n          return getFromData().bind(function (child) {\n            return isObject(child) ? getNonEmptyValue(child).orThunk(getFromMetaData) : getFromMetaData().orThunk(function () {\n              return Optional.from(child);\n            });\n          });\n        };\n        var getFromMetaFirst = function () {\n          return getFromMetaData().orThunk(function () {\n            return getFromData().bind(function (child) {\n              return isObject(child) ? getNonEmptyValue(child) : Optional.from(child);\n            });\n          });\n        };\n        return _a = {}, _a[prop] = (prop === sourceInput ? getFromValueFirst() : getFromMetaFirst()).getOr(''), _a;\n      };\n    };\n    var getDimensions = function (data, metaData) {\n      var dimensions = {};\n      get$1(data, 'dimensions').each(function (dims) {\n        each$1([\n          'width',\n          'height'\n        ], function (prop) {\n          get$1(metaData, prop).orThunk(function () {\n            return get$1(dims, prop);\n          }).each(function (value) {\n            return dimensions[prop] = value;\n          });\n        });\n      });\n      return dimensions;\n    };\n    var unwrap = function (data, sourceInput) {\n      var metaData = sourceInput ? extractMeta(sourceInput, data).getOr({}) : {};\n      var get = getValue(data, metaData, sourceInput);\n      return __assign(__assign(__assign(__assign(__assign({}, get('source')), get('altsource')), get('poster')), get('embed')), getDimensions(data, metaData));\n    };\n    var wrap = function (data) {\n      var wrapped = __assign(__assign({}, data), {\n        source: { value: get$1(data, 'source').getOr('') },\n        altsource: { value: get$1(data, 'altsource').getOr('') },\n        poster: { value: get$1(data, 'poster').getOr('') }\n      });\n      each$1([\n        'width',\n        'height'\n      ], function (prop) {\n        get$1(data, prop).each(function (value) {\n          var dimensions = wrapped.dimensions || {};\n          dimensions[prop] = value;\n          wrapped.dimensions = dimensions;\n        });\n      });\n      return wrapped;\n    };\n    var handleError = function (editor) {\n      return function (error) {\n        var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n        editor.notificationManager.open({\n          type: 'error',\n          text: errorMessage\n        });\n      };\n    };\n    var snippetToData = function (editor, embedSnippet) {\n      return htmlToData(getScripts(editor), embedSnippet);\n    };\n    var getEditorData = function (editor) {\n      var element = editor.selection.getNode();\n      var snippet = isMediaElement(element) ? editor.serializer.serialize(element, { selection: true }) : '';\n      return __assign({ embed: snippet }, htmlToData(getScripts(editor), snippet));\n    };\n    var addEmbedHtml = function (api, editor) {\n      return function (response) {\n        if (isString(response.url) && response.url.trim().length > 0) {\n          var html = response.html;\n          var snippetData = snippetToData(editor, html);\n          var nuData = __assign(__assign({}, snippetData), {\n            source: response.url,\n            embed: html\n          });\n          api.setData(wrap(nuData));\n        }\n      };\n    };\n    var selectPlaceholder = function (editor, beforeObjects) {\n      var afterObjects = editor.dom.select('*[data-mce-object]');\n      for (var i = 0; i < beforeObjects.length; i++) {\n        for (var y = afterObjects.length - 1; y >= 0; y--) {\n          if (beforeObjects[i] === afterObjects[y]) {\n            afterObjects.splice(y, 1);\n          }\n        }\n      }\n      editor.selection.select(afterObjects[0]);\n    };\n    var handleInsert = function (editor, html) {\n      var beforeObjects = editor.dom.select('*[data-mce-object]');\n      editor.insertContent(html);\n      selectPlaceholder(editor, beforeObjects);\n      editor.nodeChanged();\n    };\n    var submitForm = function (prevData, newData, editor) {\n      newData.embed = updateHtml(newData.embed, newData);\n      if (newData.embed && (prevData.source === newData.source || isCached(newData.source))) {\n        handleInsert(editor, newData.embed);\n      } else {\n        getEmbedHtml(editor, newData).then(function (response) {\n          handleInsert(editor, response.html);\n        }).catch(handleError(editor));\n      }\n    };\n    var showDialog = function (editor) {\n      var editorData = getEditorData(editor);\n      var currentData = Cell(editorData);\n      var initialData = wrap(editorData);\n      var handleSource = function (prevData, api) {\n        var serviceData = unwrap(api.getData(), 'source');\n        if (prevData.source !== serviceData.source) {\n          addEmbedHtml(win, editor)({\n            url: serviceData.source,\n            html: ''\n          });\n          getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n        }\n      };\n      var handleEmbed = function (api) {\n        var data = unwrap(api.getData());\n        var dataFromEmbed = snippetToData(editor, data.embed);\n        api.setData(wrap(dataFromEmbed));\n      };\n      var handleUpdate = function (api, sourceInput) {\n        var data = unwrap(api.getData(), sourceInput);\n        var embed = dataToHtml(editor, data);\n        api.setData(wrap(__assign(__assign({}, data), { embed: embed })));\n      };\n      var mediaInput = [{\n          name: 'source',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Source'\n        }];\n      var sizeInput = !hasDimensions(editor) ? [] : [{\n          type: 'sizeinput',\n          name: 'dimensions',\n          label: 'Constrain proportions',\n          constrain: true\n        }];\n      var generalTab = {\n        title: 'General',\n        name: 'general',\n        items: flatten([\n          mediaInput,\n          sizeInput\n        ])\n      };\n      var embedTextarea = {\n        type: 'textarea',\n        name: 'embed',\n        label: 'Paste your embed code below:'\n      };\n      var embedTab = {\n        title: 'Embed',\n        items: [embedTextarea]\n      };\n      var advancedFormItems = [];\n      if (hasAltSource(editor)) {\n        advancedFormItems.push({\n          name: 'altsource',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Alternative source URL'\n        });\n      }\n      if (hasPoster(editor)) {\n        advancedFormItems.push({\n          name: 'poster',\n          type: 'urlinput',\n          filetype: 'image',\n          label: 'Media poster (Image URL)'\n        });\n      }\n      var advancedTab = {\n        title: 'Advanced',\n        name: 'advanced',\n        items: advancedFormItems\n      };\n      var tabs = [\n        generalTab,\n        embedTab\n      ];\n      if (advancedFormItems.length > 0) {\n        tabs.push(advancedTab);\n      }\n      var body = {\n        type: 'tabpanel',\n        tabs: tabs\n      };\n      var win = editor.windowManager.open({\n        title: 'Insert/Edit Media',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        onSubmit: function (api) {\n          var serviceData = unwrap(api.getData());\n          submitForm(currentData.get(), serviceData, editor);\n          api.close();\n        },\n        onChange: function (api, detail) {\n          switch (detail.name) {\n          case 'source':\n            handleSource(currentData.get(), api);\n            break;\n          case 'embed':\n            handleEmbed(api);\n            break;\n          case 'dimensions':\n          case 'altsource':\n          case 'poster':\n            handleUpdate(api, detail.name);\n            break;\n          }\n          currentData.set(unwrap(api.getData()));\n        },\n        initialData: initialData\n      });\n    };\n\n    var get = function (editor) {\n      var showDialog$1 = function () {\n        showDialog(editor);\n      };\n      return { showDialog: showDialog$1 };\n    };\n\n    var register$1 = function (editor) {\n      var showDialog$1 = function () {\n        showDialog(editor);\n      };\n      editor.addCommand('mceMedia', showDialog$1);\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.html.Node');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var global = tinymce.util.Tools.resolve('tinymce.html.DomParser');\n\n    var sanitize = function (editor, html) {\n      if (shouldFilterHtml(editor) === false) {\n        return html;\n      }\n      var writer = global$4();\n      var blocked;\n      global$6({\n        validate: false,\n        allow_conditional_comments: false,\n        comment: function (text) {\n          if (!blocked) {\n            writer.comment(text);\n          }\n        },\n        cdata: function (text) {\n          if (!blocked) {\n            writer.cdata(text);\n          }\n        },\n        text: function (text, raw) {\n          if (!blocked) {\n            writer.text(text, raw);\n          }\n        },\n        start: function (name, attrs, empty) {\n          blocked = true;\n          if (name === 'script' || name === 'noscript' || name === 'svg') {\n            return;\n          }\n          for (var i = attrs.length - 1; i >= 0; i--) {\n            var attrName = attrs[i].name;\n            if (attrName.indexOf('on') === 0) {\n              delete attrs.map[attrName];\n              attrs.splice(i, 1);\n            }\n            if (attrName === 'style') {\n              attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n            }\n          }\n          writer.start(name, attrs, empty);\n          blocked = false;\n        },\n        end: function (name) {\n          if (blocked) {\n            return;\n          }\n          writer.end(name);\n        }\n      }, global$5({})).parse(html);\n      return writer.getContent();\n    };\n\n    var isLiveEmbedNode = function (node) {\n      var name = node.name;\n      return name === 'iframe' || name === 'video' || name === 'audio';\n    };\n    var getDimension = function (node, styles, dimension, defaultValue) {\n      if (defaultValue === void 0) {\n        defaultValue = null;\n      }\n      var value = node.attr(dimension);\n      if (isNonNullable(value)) {\n        return value;\n      } else if (!has(styles, dimension)) {\n        return defaultValue;\n      } else {\n        return null;\n      }\n    };\n    var setDimensions = function (node, previewNode, styles) {\n      var useDefaults = previewNode.name === 'img' || node.name === 'video';\n      var defaultWidth = useDefaults ? '300' : null;\n      var fallbackHeight = node.name === 'audio' ? '30' : '150';\n      var defaultHeight = useDefaults ? fallbackHeight : null;\n      previewNode.attr({\n        width: getDimension(node, styles, 'width', defaultWidth),\n        height: getDimension(node, styles, 'height', defaultHeight)\n      });\n    };\n    var appendNodeContent = function (editor, nodeName, previewNode, html) {\n      var newNode = global({\n        forced_root_block: false,\n        validate: false\n      }, editor.schema).parse(html, { context: nodeName });\n      while (newNode.firstChild) {\n        previewNode.append(newNode.firstChild);\n      }\n    };\n    var createPlaceholderNode = function (editor, node) {\n      var name = node.name;\n      var placeHolder = new global$2('img', 1);\n      placeHolder.shortEnded = true;\n      retainAttributesAndInnerHtml(editor, node, placeHolder);\n      setDimensions(node, placeHolder, {});\n      placeHolder.attr({\n        'style': node.attr('style'),\n        'src': global$1.transparentSrc,\n        'data-mce-object': name,\n        'class': 'mce-object mce-object-' + name\n      });\n      return placeHolder;\n    };\n    var createPreviewNode = function (editor, node) {\n      var name = node.name;\n      var previewWrapper = new global$2('span', 1);\n      previewWrapper.attr({\n        'contentEditable': 'false',\n        'style': node.attr('style'),\n        'data-mce-object': name,\n        'class': 'mce-preview-object mce-object-' + name\n      });\n      retainAttributesAndInnerHtml(editor, node, previewWrapper);\n      var styles = editor.dom.parseStyle(node.attr('style'));\n      var previewNode = new global$2(name, 1);\n      setDimensions(node, previewNode, styles);\n      previewNode.attr({\n        src: node.attr('src'),\n        style: node.attr('style'),\n        class: node.attr('class')\n      });\n      if (name === 'iframe') {\n        previewNode.attr({\n          allowfullscreen: node.attr('allowfullscreen'),\n          frameborder: '0'\n        });\n      } else {\n        var attrs = [\n          'controls',\n          'crossorigin',\n          'currentTime',\n          'loop',\n          'muted',\n          'poster',\n          'preload'\n        ];\n        each$1(attrs, function (attrName) {\n          previewNode.attr(attrName, node.attr(attrName));\n        });\n        var sanitizedHtml = previewWrapper.attr('data-mce-html');\n        if (isNonNullable(sanitizedHtml)) {\n          appendNodeContent(editor, name, previewNode, unescape(sanitizedHtml));\n        }\n      }\n      var shimNode = new global$2('span', 1);\n      shimNode.attr('class', 'mce-shim');\n      previewWrapper.append(previewNode);\n      previewWrapper.append(shimNode);\n      return previewWrapper;\n    };\n    var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n      var attribs = sourceNode.attributes;\n      var ai = attribs.length;\n      while (ai--) {\n        var attrName = attribs[ai].name;\n        var attrValue = attribs[ai].value;\n        if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n          if (attrName === 'data' || attrName === 'src') {\n            attrValue = editor.convertURL(attrValue, attrName);\n          }\n          targetNode.attr('data-mce-p-' + attrName, attrValue);\n        }\n      }\n      var innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n      if (innerHtml) {\n        targetNode.attr('data-mce-html', escape(sanitize(editor, innerHtml)));\n        targetNode.firstChild = null;\n      }\n    };\n    var isPageEmbedWrapper = function (node) {\n      var nodeClass = node.attr('class');\n      return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n    };\n    var isWithinEmbedWrapper = function (node) {\n      while (node = node.parent) {\n        if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var placeHolderConverter = function (editor) {\n      return function (nodes) {\n        var i = nodes.length;\n        var node;\n        var videoScript;\n        while (i--) {\n          node = nodes[i];\n          if (!node.parent) {\n            continue;\n          }\n          if (node.parent.attr('data-mce-object')) {\n            continue;\n          }\n          if (node.name === 'script') {\n            videoScript = getVideoScriptMatch(getScripts(editor), node.attr('src'));\n            if (!videoScript) {\n              continue;\n            }\n          }\n          if (videoScript) {\n            if (videoScript.width) {\n              node.attr('width', videoScript.width.toString());\n            }\n            if (videoScript.height) {\n              node.attr('height', videoScript.height.toString());\n            }\n          }\n          if (isLiveEmbedNode(node) && hasLiveEmbeds(editor) && global$1.ceFalse) {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPreviewNode(editor, node));\n            }\n          } else {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPlaceholderNode(editor, node));\n            }\n          }\n        }\n      };\n    };\n\n    var setup$1 = function (editor) {\n      editor.on('preInit', function () {\n        var specialElements = editor.schema.getSpecialElements();\n        global$8.each('video audio iframe object'.split(' '), function (name) {\n          specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n        });\n        var boolAttrs = editor.schema.getBoolAttrs();\n        global$8.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n          boolAttrs[name] = {};\n        });\n        editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', placeHolderConverter(editor));\n        editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n          var i = nodes.length;\n          var node;\n          var realElm;\n          var ai;\n          var attribs;\n          var innerHtml;\n          var innerNode;\n          var realElmName;\n          var className;\n          while (i--) {\n            node = nodes[i];\n            if (!node.parent) {\n              continue;\n            }\n            realElmName = node.attr(name);\n            realElm = new global$2(realElmName, 1);\n            if (realElmName !== 'audio' && realElmName !== 'script') {\n              className = node.attr('class');\n              if (className && className.indexOf('mce-preview-object') !== -1) {\n                realElm.attr({\n                  width: node.firstChild.attr('width'),\n                  height: node.firstChild.attr('height')\n                });\n              } else {\n                realElm.attr({\n                  width: node.attr('width'),\n                  height: node.attr('height')\n                });\n              }\n            }\n            realElm.attr({ style: node.attr('style') });\n            attribs = node.attributes;\n            ai = attribs.length;\n            while (ai--) {\n              var attrName = attribs[ai].name;\n              if (attrName.indexOf('data-mce-p-') === 0) {\n                realElm.attr(attrName.substr(11), attribs[ai].value);\n              }\n            }\n            if (realElmName === 'script') {\n              realElm.attr('type', 'text/javascript');\n            }\n            innerHtml = node.attr('data-mce-html');\n            if (innerHtml) {\n              innerNode = new global$2('#text', 3);\n              innerNode.raw = true;\n              innerNode.value = sanitize(editor, unescape(innerHtml));\n              realElm.append(innerNode);\n            }\n            node.replace(realElm);\n          }\n        });\n      });\n      editor.on('SetContent', function () {\n        editor.$('span.mce-preview-object').each(function (index, elm) {\n          var $elm = editor.$(elm);\n          if ($elm.find('span.mce-shim').length === 0) {\n            $elm.append('<span class=\"mce-shim\"></span>');\n          }\n        });\n      });\n    };\n\n    var setup = function (editor) {\n      editor.on('ResolveName', function (e) {\n        var name;\n        if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n          e.name = name;\n        }\n      });\n    };\n\n    var register = function (editor) {\n      var onAction = function () {\n        return editor.execCommand('mceMedia');\n      };\n      editor.ui.registry.addToggleButton('media', {\n        tooltip: 'Insert/edit media',\n        icon: 'embed',\n        onAction: onAction,\n        onSetup: function (buttonApi) {\n          var selection = editor.selection;\n          buttonApi.setActive(isMediaElement(selection.getNode()));\n          return selection.selectorChangedWithUnbind('img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]', buttonApi.setActive).unbind;\n        }\n      });\n      editor.ui.registry.addMenuItem('media', {\n        icon: 'embed',\n        text: 'Media...',\n        onAction: onAction\n      });\n    };\n\n    function Plugin () {\n      global$9.add('media', function (editor) {\n        register$1(editor);\n        register(editor);\n        setup(editor);\n        setup$1(editor);\n        setup$2(editor);\n        return get(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}